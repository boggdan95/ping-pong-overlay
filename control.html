<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 700;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            gap: 8px;
        }

        /* Tabs (lateral) */
        .tabs {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 50px;
        }

        .tab-button {
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid transparent;
            border-radius: 6px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-color: #667eea;
        }

        .panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== TAB PARTIDO ==================== */

        .match-header {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .visibility-toggle {
            flex: 2;
            background: #2196F3;
            color: white;
            padding: 10px;
            font-size: 13px;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .visibility-toggle:hover {
            background: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .visibility-toggle.hidden {
            background: #f44336;
        }

        .visibility-toggle.hidden:hover {
            background: #d32f2f;
        }

        .btn-reset-match {
            flex: 1;
            background: #ff9800;
            color: white;
            padding: 10px;
            font-size: 12px;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-reset-match:hover {
            background: #ff6f00;
            transform: translateY(-1px);
        }

        .players-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .player-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
        }

        .player-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .player-name-display {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-flag-display {
            font-size: 20px;
            margin-bottom: 6px;
        }

        .score-display {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 6px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
            padding: 2px 6px;
        }

        .score-display:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .score-display.editing {
            background: white;
            color: #667eea;
        }

        .score-input {
            width: 55px;
            font-size: 32px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            text-align: center;
            border: 2px solid #667eea;
            border-radius: 4px;
            padding: 2px;
        }

        .score-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .sets-display {
            font-size: 10px;
            opacity: 0.8;
            margin-bottom: 6px;
        }

        .sets-display span {
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .sets-display span:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .sets-input {
            width: 40px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            border: 1px solid #667eea;
            border-radius: 3px;
            padding: 2px;
        }

        .sets-input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .point-buttons {
            display: flex;
            gap: 6px;
        }

        .btn-point {
            flex: 1;
            padding: 10px 6px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-point-minus {
            background: #f44336;
            color: white;
        }

        .btn-point-minus:hover {
            background: #da190b;
            transform: scale(1.05);
        }

        .btn-point-plus {
            background: #4CAF50;
            color: white;
        }

        .btn-point-plus:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .service-indicator {
            margin-top: 6px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            font-size: 9px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .player-card.active .service-indicator {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
        }

        .service-indicator:hover {
            transform: scale(1.02);
        }

        /* ==================== MODAL DE CONFIRMACI√ìN ==================== */

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .modal-scores {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .modal-score-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 16px;
        }

        .modal-score-row:first-child {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 12px;
            margin-bottom: 8px;
        }

        .modal-player-name {
            font-weight: 600;
            color: #333;
        }

        .modal-player-score {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .modal-btn-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .modal-btn-cancel:hover {
            background: #e0e0e0;
        }

        /* ==================== TAB CONFIGURACI√ìN ==================== */

        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .config-section h3 {
            font-size: 12px;
            color: #667eea;
            margin-bottom: 8px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 4px;
            color: #555;
            font-size: 11px;
            text-transform: uppercase;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f5ff;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .btn-color {
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-color:hover {
            transform: scale(1.05);
        }

        .btn-color.active {
            border-color: #667eea;
            border-width: 3px;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.6);
        }

        .btn-color.green { background: #00FF00; color: #000; }
        .btn-color.blue { background: #0000FF; color: #fff; }
        .btn-color.magenta { background: #FF00FF; color: #fff; }
        .btn-color.red { background: #FF0000; color: #fff; }
        .btn-color.gradient {
            background: linear-gradient(135deg, #003d8c 0%, #0052CC 100%);
            color: #fff;
        }
        .btn-color.transparent {
            background: repeating-linear-gradient(
                45deg,
                #ccc,
                #ccc 10px,
                #fff 10px,
                #fff 20px
            );
            color: #000;
        }

        .logo-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .logo-url-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }

        .logo-file-btn {
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logo-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .btn-logo-option {
            flex: 1;
            padding: 8px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-logo-option:hover {
            border-color: #667eea;
        }

        .btn-logo-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .logo-preview {
            text-align: center;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 60px;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .btn-theme {
            padding: 12px 8px;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            background: white;
            color: #333;
        }

        .btn-theme:hover {
            transform: scale(1.03);
            border-color: #667eea;
        }

        .btn-theme.active {
            border-color: #667eea;
            border-width: 3px;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            body {
                padding: 6px;
            }

            .container {
                max-width: 100%;
            }

            h1 {
                font-size: 14px;
                margin-bottom: 6px;
            }

            /* Volver a tabs horizontales en m√≥vil */
            .main-layout {
                flex-direction: column;
            }

            .tabs {
                flex-direction: row;
                min-width: unset;
            }

            .tab-button {
                padding: 6px;
                font-size: 20px;
            }

            .panel {
                padding: 8px;
            }

            .score-display {
                font-size: 28px;
            }

            .player-name-display {
                font-size: 11px;
            }

            .player-flag-display {
                font-size: 20px;
            }

            .btn-point {
                font-size: 18px;
                padding: 10px 6px;
            }
        }

        /* Ultra compacto para cuarto de pantalla (960x540 o menos) */
        @media (max-width: 500px) {
            body {
                padding: 4px;
            }

            h1 {
                font-size: 13px;
                margin-bottom: 4px;
            }

            .tabs {
                gap: 4px;
            }

            .tab-button {
                padding: 6px 4px;
                font-size: 18px;
            }

            .panel {
                padding: 6px;
                border-radius: 6px;
            }

            .match-header {
                gap: 4px;
                margin-bottom: 6px;
            }

            .visibility-toggle,
            .btn-reset-match {
                padding: 8px;
                font-size: 11px;
            }

            .players-grid {
                gap: 6px;
            }

            .player-card {
                padding: 8px;
            }

            .player-name-display {
                font-size: 10px;
                margin-bottom: 4px;
            }

            .player-flag-display {
                font-size: 18px;
                margin-bottom: 6px;
            }

            .score-display {
                font-size: 24px;
                margin-bottom: 6px;
            }

            .sets-display {
                font-size: 9px;
                margin-bottom: 6px;
            }

            .point-buttons {
                gap: 4px;
            }

            .btn-point {
                padding: 10px 4px;
                font-size: 16px;
            }

            .service-indicator {
                margin-top: 6px;
                padding: 4px;
                font-size: 9px;
            }

            .config-section {
                padding: 8px;
                margin-bottom: 8px;
            }

            .config-section h3 {
                font-size: 10px;
            }

            .form-group input {
                padding: 6px;
                font-size: 12px;
            }

            .btn-color {
                padding: 8px;
                font-size: 12px;
            }
        }

        /* Autocomplete styles */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .autocomplete-list.active {
            display: block;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .autocomplete-item:hover {
            background: #f0f5ff;
        }

        .autocomplete-item .flag-code {
            font-weight: 600;
            color: #667eea;
            font-size: 11px;
        }

        .autocomplete-item .country {
            color: #999;
            font-size: 10px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>üèì Control Panel</h1>

        <div class="main-layout">
            <!-- Tabs (lateral) -->
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('match')" title="Partido">
                    üèì
                </button>
                <button class="tab-button" onclick="switchTab('config')" title="Configuraci√≥n">
                    ‚öôÔ∏è
                </button>
            </div>

            <div class="panel">
            <!-- TAB: PARTIDO -->
            <div id="matchTab" class="tab-content active">
                <div class="match-header">
                    <button id="visibilityToggle" class="visibility-toggle" onclick="toggleOverlayVisibility()">
                        üëÅÔ∏è Mostrar Overlay
                    </button>
                    <button class="btn-reset-match" onclick="resetAll()">
                        üîÑ Reset
                    </button>
                </div>

                <div style="margin-bottom: 10px;">
                    <button id="historyOverlayToggle" class="visibility-toggle" onclick="toggleHistoryOverlay()" style="width: 100%;">
                        üìä Mostrar Historial en Pantalla
                    </button>
                </div>

                <!-- Bot√≥n Siguiente Partido (solo visible en modo equipos) -->
                <div style="margin-bottom: 10px; display: none;" id="nextMatchButtonContainer">
                    <button class="visibility-toggle" onclick="nextMatch()" style="width: 100%; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        ‚ñ∂Ô∏è Siguiente Partido
                    </button>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-top: 4px;">
                        Resetea puntos y cambia jugadores en Configuraci√≥n
                    </div>
                </div>

                <div class="players-grid">
                    <!-- Jugador 1 -->
                    <div class="player-card" id="playerCard1">
                        <div class="player-name-display" id="player1NameDisplay">Jugador 1</div>
                        <div class="player-flag-display">
                            <span class="fi fi-es" id="player1FlagDisplay"></span>
                        </div>
                        <div class="score-display" id="player1ScoreDisplay" onclick="editScore(1)" title="Click para editar">0</div>
                        <div class="sets-display"><span id="setsLabel1">Sets</span>: <span id="player1SetsDisplay" onclick="editSets(1)" title="Click para editar">0</span></div>
                        <div class="point-buttons">
                            <button class="btn-point btn-point-minus" onclick="changePoints(1, -1)">‚àí</button>
                            <button class="btn-point btn-point-plus" onclick="changePoints(1, 1)">+</button>
                        </div>
                        <div class="service-indicator" onclick="setService(1)">
                            üéæ Servicio
                        </div>
                    </div>

                    <!-- Jugador 2 -->
                    <div class="player-card" id="playerCard2">
                        <div class="player-name-display" id="player2NameDisplay">Jugador 2</div>
                        <div class="player-flag-display">
                            <span class="fi fi-ar" id="player2FlagDisplay"></span>
                        </div>
                        <div class="score-display" id="player2ScoreDisplay" onclick="editScore(2)" title="Click para editar">0</div>
                        <div class="sets-display"><span id="setsLabel2">Sets</span>: <span id="player2SetsDisplay" onclick="editSets(2)" title="Click para editar">0</span></div>
                        <div class="point-buttons">
                            <button class="btn-point btn-point-minus" onclick="changePoints(2, -1)">‚àí</button>
                            <button class="btn-point btn-point-plus" onclick="changePoints(2, 1)">+</button>
                        </div>
                        <div class="service-indicator" onclick="setService(2)">
                            üéæ Servicio
                        </div>
                    </div>
                </div>

                <!-- Historial de Sets -->
                <div id="setsHistoryContainer" style="margin-top: 12px; display: none;">
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px;">
                        <h4 style="font-size: 12px; color: #667eea; margin-bottom: 8px; text-transform: uppercase; font-weight: 700;">üìä Historial de Sets</h4>
                        <div id="setsHistoryList" style="font-size: 12px; color: #555;"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: CONFIGURACI√ìN -->
            <div id="configTab" class="tab-content">
                <!-- Modalidad de Juego -->
                <div class="config-section">
                    <h3>üéÆ Modalidad de Juego</h3>
                    <select id="gameModeSelector" onchange="changeGameMode()" style="width: 100%; padding: 10px; border-radius: 6px; border: 2px solid #e0e0e0; font-family: 'Montserrat', sans-serif; font-size: 13px; background: white; cursor: pointer;">
                        <option value="individual">üë§ Individual (1v1)</option>
                        <option value="doubles">üë• Dobles (2v2)</option>
                        <option value="teams">üèÜ Equipos</option>
                    </select>
                    <div style="margin-top: 8px; font-size: 10px; color: #666; text-align: center;">
                        Selecciona el tipo de partido
                    </div>
                </div>

                <!-- Jugadores -->
                <div class="config-section" id="individualSection">
                    <h3>üë• Jugadores</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Jugador 1</label>
                            <div class="autocomplete-container">
                                <input type="text" id="player1Name" value="H√©ctor L√≥pez" onchange="updateData()" oninput="handleAutocomplete(this, 1)" onfocus="handleAutocompleteFocus(this, 1)" onblur="hideAutocomplete(1)">
                                <div id="autocomplete1" class="autocomplete-list"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="player1Flag" value="ESP" maxlength="3" onchange="updateData()" placeholder="ESP" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Jugador 2</label>
                            <div class="autocomplete-container">
                                <input type="text" id="player2Name" value="Susana Mart√≠nez" onchange="updateData()" oninput="handleAutocomplete(this, 2)" onfocus="handleAutocompleteFocus(this, 2)" onblur="hideAutocomplete(2)">
                                <div id="autocomplete2" class="autocomplete-list"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="player2Flag" value="ARG" maxlength="3" onchange="updateData()" placeholder="ARG" style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>

                <!-- Dobles -->
                <div class="config-section" id="doublesSection" style="display: none;">
                    <h3>üë• Dobles</h3>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px;">
                        Usa formato: Apellido1 / Apellido2
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pareja 1</label>
                            <input type="text" id="doublesTeam1Name" value="" onchange="updateData()" placeholder="L√≥pez / Garc√≠a">
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="doublesTeam1Flag" value="ESP" maxlength="3" onchange="updateData()" placeholder="ESP" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pareja 2</label>
                            <input type="text" id="doublesTeam2Name" value="" onchange="updateData()" placeholder="Mart√≠nez / Rodr√≠guez">
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="doublesTeam2Flag" value="ARG" maxlength="3" onchange="updateData()" placeholder="ARG" style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>

                <!-- Equipos -->
                <div class="config-section" id="teamsSection" style="display: none;">
                    <h3>üèÜ Nombres de Equipos</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Equipo 1</label>
                            <input type="text" id="team1Name" value="" onchange="updateData()" placeholder="Equipo A">
                        </div>
                        <div class="form-group">
                            <label>Equipo 2</label>
                            <input type="text" id="team2Name" value="" onchange="updateData()" placeholder="Equipo B">
                        </div>
                    </div>
                    <h3 style="margin-top: 12px;">üë• Partido Individual Actual</h3>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px;">
                        Jugadores que est√°n compitiendo ahora
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jugador (Equipo 1)</label>
                            <div class="autocomplete-container">
                                <input type="text" id="teamsCurrentPlayer1" value="" onchange="updateData()" placeholder="Nombre jugador" oninput="handleAutocomplete(this, 3)" onfocus="handleAutocompleteFocus(this, 3)" onblur="hideAutocomplete(3)">
                                <div id="autocomplete3" class="autocomplete-list"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="teamsCurrentFlag1" value="ESP" maxlength="3" onchange="updateData()" placeholder="ESP" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jugador (Equipo 2)</label>
                            <div class="autocomplete-container">
                                <input type="text" id="teamsCurrentPlayer2" value="" onchange="updateData()" placeholder="Nombre jugador" oninput="handleAutocomplete(this, 4)" onfocus="handleAutocompleteFocus(this, 4)" onblur="hideAutocomplete(4)">
                                <div id="autocomplete4" class="autocomplete-list"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="teamsCurrentFlag2" value="ARG" maxlength="3" onchange="updateData()" placeholder="ARG" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; color: #666; text-align: center;">
                        Cada partido individual ganado suma 1 punto al pa√≠s (se usan los "Sets" para contar)
                    </div>
                </div>

                <!-- Modo de Partido -->
                <div class="config-section">
                    <h3>üèÜ Sets para Ganar</h3>
                    <div class="logo-options">
                        <button class="btn-logo-option" id="modeBest3" onclick="setMatchMode('best-of-3')">
                            Mejor de 3
                        </button>
                        <button class="btn-logo-option active" id="modeBest5" onclick="setMatchMode('best-of-5')">
                            Mejor de 5
                        </button>
                        <button class="btn-logo-option" id="modeBest7" onclick="setMatchMode('best-of-7')">
                            Mejor de 7
                        </button>
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; color: #666; text-align: center;">
                        <span id="setsToWinLabel">Primero en ganar 3 sets</span>
                    </div>
                </div>

                <!-- Pantalla de Ganador -->
                <div class="config-section">
                    <h3>üèÜ Pantalla de Ganador</h3>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px;">
                        Se muestra autom√°ticamente al ganar el partido
                    </div>
                    <button id="winnerOverlayToggle" class="visibility-toggle" onclick="toggleWinnerOverlay()" style="width: 100%; display: none; margin-bottom: 8px;">
                        üôà Ocultar Pantalla de Ganador
                    </button>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px; margin-top: 8px;">
                        Animaciones (Confetti)
                    </div>
                    <div class="logo-options">
                        <button class="btn-logo-option active" id="animationsOn" onclick="setAnimations(true)">
                            ‚úÖ Activadas
                        </button>
                        <button class="btn-logo-option" id="animationsOff" onclick="setAnimations(false)">
                            üö´ Desactivadas
                        </button>
                    </div>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px; margin-top: 12px;">
                        Emoji de Celebraci√≥n
                    </div>
                    <div class="logo-options">
                        <button class="btn-logo-option active" id="emojiTrophy" onclick="setWinnerEmoji('üèÜ')">
                            üèÜ Trofeo
                        </button>
                        <button class="btn-logo-option" id="emojiMedal" onclick="setWinnerEmoji('ü•á')">
                            ü•á Medalla
                        </button>
                        <button class="btn-logo-option" id="emojiCup" onclick="setWinnerEmoji('üèÖ')">
                            üèÖ Medalla 2
                        </button>
                        <button class="btn-logo-option" id="emojiStar" onclick="setWinnerEmoji('‚≠ê')">
                            ‚≠ê Estrella
                        </button>
                        <button class="btn-logo-option" id="emojiCrown" onclick="setWinnerEmoji('üëë')">
                            üëë Corona
                        </button>
                    </div>
                </div>

                <!-- Tema del Scoreboard -->
                <div class="config-section">
                    <h3>üé® Tema del Scoreboard</h3>
                    <div class="theme-grid">
                        <button class="btn-theme" id="themeAzulModerno" onclick="setTheme('azulModerno')">
                            üîµ Azul Moderno
                        </button>
                        <button class="btn-theme" id="themeOscuroElegante" onclick="setTheme('oscuroElegante')">
                            üåë Oscuro Elegante
                        </button>
                        <button class="btn-theme" id="themeClaroMinimalista" onclick="setTheme('claroMinimalista')">
                            ‚òÄÔ∏è Claro Minimalista
                        </button>
                        <button class="btn-theme" id="themeNeonNocturno" onclick="setTheme('neonNocturno')">
                            üåÜ Ne√≥n Nocturno
                        </button>
                        <button class="btn-theme" id="themeDoradoPremium" onclick="setTheme('doradoPremium')">
                            üèÜ Dorado Premium
                        </button>
                        <button class="btn-theme" id="themeVerdeDeportivo" onclick="setTheme('verdeDeportivo')">
                            üéæ Verde Deportivo
                        </button>
                    </div>
                </div>

                <!-- Color de Fondo -->
                <div class="config-section">
                    <h3>üé® Color de Fondo (Chroma Key)</h3>
                    <div class="color-grid">
                        <button class="btn-color green active" onclick="setBackground('green')" id="bgGreen">
                            üü¢ Verde
                        </button>
                        <button class="btn-color blue" onclick="setBackground('blue')" id="bgBlue">
                            üîµ Azul
                        </button>
                        <button class="btn-color magenta" onclick="setBackground('magenta')" id="bgMagenta">
                            üü£ Magenta
                        </button>
                        <button class="btn-color red" onclick="setBackground('red')" id="bgRed">
                            üî¥ Rojo
                        </button>
                        <button class="btn-color gradient" onclick="setBackground('gradient')" id="bgGradient">
                            üåà Degradado
                        </button>
                        <button class="btn-color transparent" onclick="setBackground('transparent')" id="bgTransparent">
                            ‚ö™ Transparente
                        </button>
                    </div>
                </div>

                <!-- Logo -->
                <div class="config-section">
                    <h3>üñºÔ∏è Logo</h3>
                    <div class="logo-input-group">
                        <input type="text" id="logoUrl" class="logo-url-input" placeholder="URL del logo o pega imagen" onchange="updateLogoUrl()">
                        <input type="file" id="logoFile" accept="image/*" style="display: none;" onchange="handleLogoFile(event)">
                        <button class="logo-file-btn" onclick="document.getElementById('logoFile').click()">üìÅ Subir</button>
                    </div>
                    <div class="logo-options">
                        <button class="btn-logo-option active" id="logoLeft" onclick="setLogoPosition('left')">‚¨ÖÔ∏è Izquierda</button>
                        <button class="btn-logo-option" id="logoRight" onclick="setLogoPosition('right')">Derecha ‚û°Ô∏è</button>
                        <button class="btn-logo-option" id="logoToggle" onclick="toggleLogo()">üö´ Desactivado</button>
                    </div>
                    <div id="logoPreview" class="logo-preview">
                        <img id="logoPreviewImg" src="" alt="Vista previa del logo">
                    </div>
                </div>

                <!-- Sistema de Autosugerencia -->
                <div class="config-section">
                    <h3>üìã Base de Datos de Jugadores</h3>
                    <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 8px;">
                        Carga un CSV para autocompletar nombres r√°pidamente
                    </div>
                    <div class="logo-input-group">
                        <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleCSVFile(event)">
                        <button class="logo-file-btn" onclick="document.getElementById('csvFile').click()" style="width: 100%;">
                            üìÅ Cargar CSV de Jugadores
                        </button>
                    </div>
                    <div style="font-size: 9px; color: #999; text-align: center; margin-top: 4px;">
                        Formato: nombre,bandera,pa√≠s (ej: Juan P√©rez,ESP,Espa√±a)
                    </div>
                    <div id="playersDbStatus" style="margin-top: 8px; font-size: 11px; color: #667eea; text-align: center; display: none;">
                        ‚úÖ <span id="playersCount">0</span> jugadores cargados
                    </div>
                    <div id="autocompleteToggleContainer" style="margin-top: 8px; display: none;">
                        <div style="font-size: 10px; color: #666; text-align: center; margin-bottom: 6px;">
                            Autocompletado
                        </div>
                        <div class="logo-options">
                            <button class="btn-logo-option active" id="autocompleteOn" onclick="setAutocompleteEnabled(true)">
                                ‚úÖ Activado
                            </button>
                            <button class="btn-logo-option" id="autocompleteOff" onclick="setAutocompleteEnabled(false)">
                                üö´ Desactivado
                            </button>
                        </div>
                    </div>
                    <button id="clearPlayersDb" onclick="clearPlayersDatabase()" style="width: 100%; padding: 6px; margin-top: 6px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; display: none;">
                        üóëÔ∏è Limpiar Base de Datos
                    </button>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Set -->
    <div id="setConfirmModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="setModalTitle">üèÜ ¬øConfirmar Set Ganado?</div>
            </div>
            <div class="modal-scores">
                <div class="modal-score-row">
                    <span class="modal-player-name" id="modalPlayer1Name">Jugador 1</span>
                    <span class="modal-player-score" id="modalPlayer1Score">11</span>
                </div>
                <div class="modal-score-row">
                    <span class="modal-player-name" id="modalPlayer2Name">Jugador 2</span>
                    <span class="modal-player-score" id="modalPlayer2Score">9</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="cancelSetWin()">
                    ‚ùå Cancelar
                </button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmSetWin()">
                    ‚úÖ Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Ganador del Partido -->
    <div id="matchWinnerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üèÜ ¬øConfirmar Ganador?</div>
            </div>
            <div class="modal-scores">
                <div style="text-align: center; margin-bottom: 8px;">
                    <div style="font-size: 40px; margin-bottom: 4px;">
                        <span id="matchWinnerFlag" class="fi fi-es"></span>
                    </div>
                    <div style="font-size: 14px; font-weight: 700; color: #667eea;" id="matchWinnerName">Jugador 1</div>
                </div>
                <div class="modal-score-row">
                    <span class="modal-player-name" id="matchModalPlayer1Name">Jugador 1</span>
                    <span class="modal-player-score" id="matchModalPlayer1Sets">3</span>
                </div>
                <div class="modal-score-row">
                    <span class="modal-player-name" id="matchModalPlayer2Name">Jugador 2</span>
                    <span class="modal-player-score" id="matchModalPlayer2Sets">0</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="cancelMatchWin()">
                    ‚ùå Cancelar
                </button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmMatchWin()">
                    ‚úÖ Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n de partido individual ganado (modo equipos) -->
    <div id="individualMatchWinnerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üéØ ¬øConfirmar Partido Ganado?</div>
            </div>
            <div class="modal-scores">
                <div style="text-align: center; margin-bottom: 8px;">
                    <div style="font-size: 40px; margin-bottom: 4px;">
                        <span id="individualMatchWinnerFlag" class="fi fi-es"></span>
                    </div>
                    <div style="font-size: 14px; font-weight: 700; color: #667eea;" id="individualMatchWinnerName">Jugador 1</div>
                    <div style="font-size: 12px; margin-top: 4px; color: #888;">+1 punto para <span id="individualMatchWinnerCountry">Pa√≠s</span></div>
                </div>
                <div class="modal-score-row">
                    <span class="modal-player-name" id="individualMatchModalPlayer1Name">Jugador 1</span>
                    <span class="modal-player-score" id="individualMatchModalPlayer1Sets">3</span>
                </div>
                <div class="modal-score-row">
                    <span class="modal-player-name" id="individualMatchModalPlayer2Name">Jugador 2</span>
                    <span class="modal-player-score" id="individualMatchModalPlayer2Sets">0</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="cancelIndividualMatchWin()">
                    ‚ùå Cancelar
                </button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmIndividualMatchWin()">
                    ‚úÖ Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mapeo de c√≥digos de 3 letras a c√≥digos ISO 3166-1 alpha-2
        const countryCodeMap = {
            'GUA': 'gt', 'ESA': 'sv', 'NCA': 'ni', 'HON': 'hn', 'PAN': 'pa',
            'CRC': 'cr', 'BLZ': 'bz', 'MEX': 'mx', 'USA': 'us', 'CAN': 'ca',
            'ESP': 'es', 'ARG': 'ar', 'BRA': 'br', 'CHI': 'cl', 'COL': 'co',
            'URU': 'uy', 'VEN': 've', 'PER': 'pe', 'ECU': 'ec', 'BOL': 'bo',
            'PAR': 'py', 'CUB': 'cu', 'DOM': 'do', 'PRI': 'pr', 'JAM': 'jm',
            'CHN': 'cn', 'JPN': 'jp', 'KOR': 'kr', 'IND': 'in', 'THA': 'th',
            'FRA': 'fr', 'GER': 'de', 'ITA': 'it', 'GBR': 'gb', 'POR': 'pt',
            'NED': 'nl', 'BEL': 'be', 'SWE': 'se', 'NOR': 'no', 'DEN': 'dk',
            'AUS': 'au', 'NZL': 'nz', 'RSA': 'za', 'EGY': 'eg', 'NGA': 'ng'
        };

        // Funci√≥n para convertir c√≥digo de 3 letras a c√≥digo ISO de 2 letras
        function getISO2Code(code3) {
            return countryCodeMap[code3.toUpperCase()] || code3.toLowerCase().slice(0, 2);
        }

        // Temas predefinidos
        const themes = {
            azulModerno: {
                name: 'üîµ Azul Moderno',
                background: 'linear-gradient(135deg, #003d8c 0%, #0052CC 100%)',
                textColor: '#ffffff',
                borderColor: 'rgba(255, 255, 255, 0.15)',
                flagBorder: 'rgba(255, 255, 255, 0.3)',
                serviceBall: '#ffffff',
                shadow: 'rgba(0, 0, 0, 0.4)'
            },
            oscuroElegante: {
                name: 'üåë Oscuro Elegante',
                background: 'linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%)',
                textColor: '#ffffff',
                borderColor: 'rgba(255, 255, 255, 0.1)',
                flagBorder: 'rgba(255, 215, 0, 0.5)',
                serviceBall: '#ffffff',
                shadow: 'rgba(0, 0, 0, 0.6)'
            },
            claroMinimalista: {
                name: '‚òÄÔ∏è Claro Minimalista',
                background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
                textColor: '#2c3e50',
                borderColor: 'rgba(44, 62, 80, 0.1)',
                flagBorder: 'rgba(44, 62, 80, 0.3)',
                serviceBall: '#1a237e',
                shadow: 'rgba(0, 0, 0, 0.2)'
            },
            neonNocturno: {
                name: 'üåÜ Ne√≥n Nocturno',
                background: 'linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%)',
                textColor: '#00ffff',
                borderColor: 'rgba(0, 255, 255, 0.3)',
                flagBorder: 'rgba(255, 0, 255, 0.6)',
                serviceBall: '#ffffff',
                shadow: 'rgba(0, 0, 0, 0.8)'
            },
            doradoPremium: {
                name: 'üèÜ Dorado Premium',
                background: 'linear-gradient(135deg, #3a1c71 0%, #d76d77 50%, #ffaf7b 100%)',
                textColor: '#ffffff',
                borderColor: 'rgba(255, 215, 0, 0.3)',
                flagBorder: 'rgba(255, 215, 0, 0.6)',
                serviceBall: '#ffffff',
                shadow: 'rgba(0, 0, 0, 0.5)'
            },
            verdeDeportivo: {
                name: 'üéæ Verde Deportivo',
                background: 'linear-gradient(135deg, #134e4a 0%, #14532d 100%)',
                textColor: '#ffffff',
                borderColor: 'rgba(74, 222, 128, 0.2)',
                flagBorder: 'rgba(74, 222, 128, 0.5)',
                serviceBall: '#4ade80',
                shadow: 'rgba(0, 0, 0, 0.5)'
            }
        };

        // Estado global
        let gameState = {
            gameMode: 'individual',    // 'individual', 'doubles' o 'teams'
            player1: { name: 'H√©ctor L√≥pez', points: 0, sets: 0, service: true, flag: 'ESP' },
            player2: { name: 'Susana Mart√≠nez', points: 0, sets: 0, service: false, flag: 'ARG' },
            doubles: {                 // Datos para modo dobles (formato: "Apellido1 / Apellido2")
                team1: { name: '', flag: 'ESP' },
                team2: { name: '', flag: 'ARG' }
            },
            teams: {                   // Datos para modo equipos
                team1: { name: '' },   // Nombre del equipo
                team2: { name: '' },   // Nombre del equipo
                currentMatch: {        // Partido individual actual
                    player1: { name: '', flag: 'ESP' },
                    player2: { name: '', flag: 'ARG' }
                },
                individualMatchSets: {  // Sets del partido individual actual (resetea entre partidos)
                    player1: 0,
                    player2: 0
                },
                countryPoints: {        // Puntos acumulados del pa√≠s (partidos ganados)
                    team1: 0,
                    team2: 0
                }
            },
            background: {
                type: 'solid',
                color: '#00FF00'
            },
            logo: {
                url: '',
                position: 'left',
                enabled: false
            },
            overlayVisible: true,
            theme: 'azulModerno',
            matchMode: 'best-of-5',    // 'best-of-3', 'best-of-5' o 'best-of-7'
            setsHistory: [],           // Historial de sets: [{player1Points: 11, player2Points: 9}, ...]
            showHistoryOverlay: false, // Mostrar overlay de historial de sets
            winner: {                  // Informaci√≥n del ganador del partido
                detected: false,
                player: null,          // 1 o 2
                finalScore: '',        // ej: '3-1'
                emoji: 'üèÜ'            // Emoji de celebraci√≥n
            },
            animations: {
                point1: 0,
                point2: 0,
                set1: 0,
                set2: 0,
                service: 0
            }
        };

        // Cambiar entre tabs
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            if (tabName === 'match') {
                document.getElementById('matchTab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else if (tabName === 'config') {
                document.getElementById('configTab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
            }
        }

        // Cargar estado
        function loadState() {
            const saved = localStorage.getItem('gameState');
            if (saved) {
                gameState = JSON.parse(saved);

                // Asegurar que exista el campo animations
                if (!gameState.animations) {
                    gameState.animations = {
                        point1: 0,
                        point2: 0,
                        set1: 0,
                        set2: 0,
                        service: 0
                    };
                }

                // Asegurar que exista el campo theme
                if (!gameState.theme) {
                    gameState.theme = 'azulModerno';
                }

                // Asegurar que existan campos de historial
                if (!gameState.matchMode) {
                    gameState.matchMode = 'best-of-5';
                }
                if (!gameState.setsHistory) {
                    gameState.setsHistory = [];
                }
                if (gameState.showHistoryOverlay === undefined) {
                    gameState.showHistoryOverlay = false;
                }
                // Asegurar que exista el campo winner
                if (!gameState.winner) {
                    gameState.winner = {
                        detected: false,
                        player: null,
                        finalScore: '',
                        emoji: 'üèÜ'
                    };
                }
                // Asegurar que exista el emoji en winner
                if (!gameState.winner.emoji) {
                    gameState.winner.emoji = 'üèÜ';
                }
                // Asegurar que exista el campo gameMode
                if (!gameState.gameMode) {
                    gameState.gameMode = 'individual';
                }
                // Asegurar que existan estructuras para doubles y teams
                if (!gameState.doubles) {
                    gameState.doubles = {
                        team1: { name: '', flag: 'ESP' },
                        team2: { name: '', flag: 'ARG' }
                    };
                }
                if (!gameState.teams) {
                    gameState.teams = {
                        team1: { name: '' },
                        team2: { name: '' },
                        currentMatch: {
                            player1: { name: '', flag: 'ESP' },
                            player2: { name: '', flag: 'ARG' }
                        }
                    };
                }
                // Asegurar que existe currentMatch en teams (para compatibilidad)
                if (gameState.teams && !gameState.teams.currentMatch) {
                    gameState.teams.currentMatch = {
                        player1: { name: '', flag: 'ESP' },
                        player2: { name: '', flag: 'ARG' }
                    };
                }
                // Asegurar que existen individualMatchSets en teams
                if (gameState.teams && !gameState.teams.individualMatchSets) {
                    gameState.teams.individualMatchSets = {
                        player1: 0,
                        player2: 0
                    };
                }
                // Asegurar que existen countryPoints en teams
                if (gameState.teams && !gameState.teams.countryPoints) {
                    gameState.teams.countryPoints = {
                        team1: 0,
                        team2: 0
                    };
                }
            }
            updateDisplay();
        }

        // Actualizar pantalla
        function updateDisplay() {
            // Actualizar selector de modalidad
            document.getElementById('gameModeSelector').value = gameState.gameMode || 'individual';

            // Mostrar/ocultar secciones seg√∫n modalidad
            document.getElementById('individualSection').style.display = (gameState.gameMode === 'individual') ? 'block' : 'none';
            document.getElementById('doublesSection').style.display = (gameState.gameMode === 'doubles') ? 'block' : 'none';
            document.getElementById('teamsSection').style.display = (gameState.gameMode === 'teams') ? 'block' : 'none';

            // Tab Configuraci√≥n - Individual
            document.getElementById('player1Name').value = gameState.player1.name;
            document.getElementById('player2Name').value = gameState.player2.name;
            document.getElementById('player1Flag').value = gameState.player1.flag;
            document.getElementById('player2Flag').value = gameState.player2.flag;

            // Tab Configuraci√≥n - Dobles
            if (gameState.doubles) {
                document.getElementById('doublesTeam1Name').value = gameState.doubles.team1.name || '';
                document.getElementById('doublesTeam1Flag').value = gameState.doubles.team1.flag || 'ESP';
                document.getElementById('doublesTeam2Name').value = gameState.doubles.team2.name || '';
                document.getElementById('doublesTeam2Flag').value = gameState.doubles.team2.flag || 'ARG';
            }

            // Tab Configuraci√≥n - Equipos
            if (gameState.teams) {
                document.getElementById('team1Name').value = gameState.teams.team1.name || '';
                document.getElementById('team2Name').value = gameState.teams.team2.name || '';
                if (gameState.teams.currentMatch) {
                    document.getElementById('teamsCurrentPlayer1').value = gameState.teams.currentMatch.player1.name || '';
                    document.getElementById('teamsCurrentFlag1').value = gameState.teams.currentMatch.player1.flag || 'ESP';
                    document.getElementById('teamsCurrentPlayer2').value = gameState.teams.currentMatch.player2.name || '';
                    document.getElementById('teamsCurrentFlag2').value = gameState.teams.currentMatch.player2.flag || 'ARG';
                }
            }

            // Tab Partido - Display (actualizar seg√∫n modalidad)
            let displayName1 = gameState.player1.name;
            let displayName2 = gameState.player2.name;
            let displayFlag1 = gameState.player1.flag;
            let displayFlag2 = gameState.player2.flag;

            // Obtener nombres seg√∫n modalidad
            if (gameState.gameMode === 'doubles') {
                displayName1 = gameState.doubles.team1.name || 'Pareja 1';
                displayName2 = gameState.doubles.team2.name || 'Pareja 2';
                displayFlag1 = gameState.doubles.team1.flag;
                displayFlag2 = gameState.doubles.team2.flag;
            } else if (gameState.gameMode === 'teams') {
                if (gameState.teams.currentMatch) {
                    displayName1 = gameState.teams.currentMatch.player1.name || 'Jugador 1';
                    displayName2 = gameState.teams.currentMatch.player2.name || 'Jugador 2';
                    displayFlag1 = gameState.teams.currentMatch.player1.flag;
                    displayFlag2 = gameState.teams.currentMatch.player2.flag;
                }
            }

            document.getElementById('player1NameDisplay').textContent = displayName1;
            document.getElementById('player2NameDisplay').textContent = displayName2;
            document.getElementById('player1ScoreDisplay').textContent = gameState.player1.points;
            document.getElementById('player2ScoreDisplay').textContent = gameState.player2.points;
            document.getElementById('player1SetsDisplay').textContent = gameState.player1.sets;
            document.getElementById('player2SetsDisplay').textContent = gameState.player2.sets;

            // Cambiar label "Sets" o "Partidos" seg√∫n modalidad
            const setsLabelText = (gameState.gameMode === 'teams') ? 'Partidos' : 'Sets';
            document.getElementById('setsLabel1').textContent = setsLabelText;
            document.getElementById('setsLabel2').textContent = setsLabelText;

            // Banderas
            const flag1 = getISO2Code(displayFlag1);
            const flag2 = getISO2Code(displayFlag2);
            document.getElementById('player1FlagDisplay').className = `fi fi-${flag1}`;
            document.getElementById('player2FlagDisplay').className = `fi fi-${flag2}`;

            // Indicador de servicio (resaltar card activo)
            const card1 = document.getElementById('playerCard1');
            const card2 = document.getElementById('playerCard2');
            if (gameState.player1.service) {
                card1.classList.add('active');
                card2.classList.remove('active');
            } else {
                card1.classList.remove('active');
                card2.classList.add('active');
            }

            // Bot√≥n de visibilidad
            updateVisibilityButton();

            // Bot√≥n de historial overlay
            updateHistoryOverlayButton();

            // Bot√≥n de pantalla de ganador
            updateWinnerOverlayButton();

            // Botones de color activos
            updateBackgroundButtons();

            // Botones de tema activos
            updateThemeButtons();

            // Botones de modo de partido
            updateMatchModeButtons();

            // Botones de animaciones
            updateAnimationsButtons();

            // Botones de emoji de celebraci√≥n
            updateWinnerEmojiButtons();

            // Historial de sets
            updateSetsHistory();

            // Logo UI
            updateLogoUI();

            // Mostrar/ocultar bot√≥n "Siguiente Partido" (solo en modo equipos)
            const nextMatchBtn = document.getElementById('nextMatchButtonContainer');
            if (nextMatchBtn) {
                nextMatchBtn.style.display = (gameState.gameMode === 'teams') ? 'block' : 'none';
            }

            // Guardar
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        // Actualizar bot√≥n de visibilidad
        function updateVisibilityButton() {
            const btn = document.getElementById('visibilityToggle');
            if (gameState.overlayVisible) {
                btn.textContent = 'üôà Ocultar Overlay';
                btn.classList.remove('hidden');
            } else {
                btn.textContent = 'üëÅÔ∏è Mostrar Overlay';
                btn.classList.add('hidden');
            }
        }

        // Toggle visibilidad del overlay
        function toggleOverlayVisibility() {
            gameState.overlayVisible = !gameState.overlayVisible;
            updateDisplay();
        }

        // Toggle overlay de historial
        function toggleHistoryOverlay() {
            gameState.showHistoryOverlay = !gameState.showHistoryOverlay;
            updateDisplay();
        }

        // Ocultar pantalla de ganador (se muestra autom√°ticamente al ganar)
        function toggleWinnerOverlay() {
            if (!gameState.winner) return;

            // Solo ocultar (la pantalla se muestra autom√°ticamente al ganar)
            gameState.winner.showOverlay = false;
            updateDisplay();
        }

        // Actualizar bot√≥n de historial overlay
        function updateHistoryOverlayButton() {
            const btn = document.getElementById('historyOverlayToggle');
            const hasHistory = gameState.setsHistory && gameState.setsHistory.length > 0;

            if (gameState.showHistoryOverlay) {
                btn.textContent = 'üôà Ocultar Historial en Pantalla';
                btn.classList.add('hidden');
            } else {
                btn.textContent = 'üìä Mostrar Historial en Pantalla';
                btn.classList.remove('hidden');
            }

            // Deshabilitar si no hay historial
            btn.disabled = !hasHistory;
            btn.style.opacity = hasHistory ? '1' : '0.5';
            btn.style.cursor = hasHistory ? 'pointer' : 'not-allowed';
        }

        // Actualizar bot√≥n de pantalla de ganador
        function updateWinnerOverlayButton() {
            const btn = document.getElementById('winnerOverlayToggle');
            const hasWinner = gameState.winner && gameState.winner.detected;

            if (hasWinner && gameState.winner.showOverlay) {
                // Solo mostrar bot√≥n cuando la pantalla est√° visible (para poder ocultarla)
                btn.style.display = 'block';
                btn.textContent = 'üôà Ocultar Pantalla de Ganador';
                btn.classList.add('hidden');
            } else {
                btn.style.display = 'none';
            }
        }

        // Actualizar botones de color activos
        function updateBackgroundButtons() {
            document.querySelectorAll('.btn-color').forEach(btn => btn.classList.remove('active'));

            const bg = gameState.background;
            if (bg.type === 'gradient') {
                document.getElementById('bgGradient').classList.add('active');
            } else if (bg.type === 'transparent') {
                document.getElementById('bgTransparent').classList.add('active');
            } else if (bg.type === 'solid') {
                if (bg.color === '#00FF00') {
                    document.getElementById('bgGreen').classList.add('active');
                } else if (bg.color === '#0000FF') {
                    document.getElementById('bgBlue').classList.add('active');
                } else if (bg.color === '#FF00FF') {
                    document.getElementById('bgMagenta').classList.add('active');
                } else if (bg.color === '#FF0000') {
                    document.getElementById('bgRed').classList.add('active');
                }
            }
        }

        // Actualizar datos
        function updateData() {
            // Modo Individual
            if (gameState.gameMode === 'individual') {
                gameState.player1.name = document.getElementById('player1Name').value || 'Jugador 1';
                gameState.player2.name = document.getElementById('player2Name').value || 'Jugador 2';
                gameState.player1.flag = (document.getElementById('player1Flag').value || 'ESP').toUpperCase().slice(0, 3);
                gameState.player2.flag = (document.getElementById('player2Flag').value || 'ARG').toUpperCase().slice(0, 3);
            }
            // Modo Dobles
            else if (gameState.gameMode === 'doubles') {
                gameState.doubles.team1.name = document.getElementById('doublesTeam1Name').value || 'Pareja 1';
                gameState.doubles.team1.flag = (document.getElementById('doublesTeam1Flag').value || 'ESP').toUpperCase().slice(0, 3);
                gameState.doubles.team2.name = document.getElementById('doublesTeam2Name').value || 'Pareja 2';
                gameState.doubles.team2.flag = (document.getElementById('doublesTeam2Flag').value || 'ARG').toUpperCase().slice(0, 3);
            }
            // Modo Equipos
            else if (gameState.gameMode === 'teams') {
                gameState.teams.team1.name = document.getElementById('team1Name').value || 'Equipo 1';
                gameState.teams.team2.name = document.getElementById('team2Name').value || 'Equipo 2';
                gameState.teams.currentMatch.player1.name = document.getElementById('teamsCurrentPlayer1').value || 'Jugador 1';
                gameState.teams.currentMatch.player1.flag = (document.getElementById('teamsCurrentFlag1').value || 'ESP').toUpperCase().slice(0, 3);
                gameState.teams.currentMatch.player2.name = document.getElementById('teamsCurrentPlayer2').value || 'Jugador 2';
                gameState.teams.currentMatch.player2.flag = (document.getElementById('teamsCurrentFlag2').value || 'ARG').toUpperCase().slice(0, 3);
            }

            updateDisplay();
        }

        // Cambiar modalidad de juego
        function changeGameMode() {
            const newMode = document.getElementById('gameModeSelector').value;
            gameState.gameMode = newMode;

            // Mostrar/ocultar secciones seg√∫n modalidad
            document.getElementById('individualSection').style.display = (newMode === 'individual') ? 'block' : 'none';
            document.getElementById('doublesSection').style.display = (newMode === 'doubles') ? 'block' : 'none';
            document.getElementById('teamsSection').style.display = (newMode === 'teams') ? 'block' : 'none';

            updateDisplay();
        }

        // Actualizar servicio (respeta cambios manuales)
        function updateService() {
            const totalPoints = gameState.player1.points + gameState.player2.points;
            const p1 = gameState.player1.points;
            const p2 = gameState.player2.points;

            // Si hay un override manual activo
            if (manualServiceOverride && manualServiceStartPoint !== null) {
                // En deuce (10-10+), servicio cambia cada punto
                if (p1 >= 10 && p2 >= 10) {
                    const pointsSinceManual = totalPoints - manualServiceStartPoint;
                    // Si ya pas√≥ 1 punto o m√°s, resetear el override
                    if (pointsSinceManual >= 1) {
                        manualServiceOverride = false;
                        manualServiceStartPoint = null;
                        // Continuar al c√°lculo autom√°tico
                    } else {
                        return; // Mantener el servicio manual
                    }
                } else {
                    // Antes del 10-10, servicio cambia cada 2 puntos
                    // Si el override se hizo en 0-0, mantener hasta que llegue a total=2
                    // Si se hizo en otro punto, mantener hasta el siguiente m√∫ltiplo de 2
                    const nextMultipleOf2 = Math.ceil((manualServiceStartPoint + 1) / 2) * 2;

                    if (totalPoints < nextMultipleOf2) {
                        // A√∫n no llegamos al siguiente m√∫ltiplo de 2, mantener el servicio manual
                        return;
                    } else if (totalPoints === nextMultipleOf2) {
                        // Llegamos exactamente al m√∫ltiplo de 2, resetear override
                        // El c√°lculo autom√°tico tomar√° control desde aqu√≠
                        manualServiceOverride = false;
                        manualServiceStartPoint = null;
                        // Continuar al c√°lculo autom√°tico
                    }
                }
            }

            // C√°lculo autom√°tico normal - SOLO si NO hay override manual
            if (p1 >= 10 && p2 >= 10) {
                gameState.player1.service = (totalPoints % 2) === 0;
                gameState.player2.service = !gameState.player1.service;
            } else {
                // Calcular servicio basado en qui√©n sirvi√≥ primero
                const serviceBlock = Math.floor(totalPoints / 2) % 2;

                // Si firstServer est√° definido, usar esa informaci√≥n
                if (firstServer !== null) {
                    // Si firstServer es 1, entonces J1 sirve en bloques pares (0, 2, 4...) y J2 en impares
                    // Si firstServer es 2, entonces J2 sirve en bloques pares y J1 en impares
                    if (firstServer === 1) {
                        gameState.player1.service = serviceBlock === 0;
                        gameState.player2.service = serviceBlock === 1;
                    } else {
                        gameState.player1.service = serviceBlock === 1;
                        gameState.player2.service = serviceBlock === 0;
                    }
                } else {
                    // Fallback al comportamiento por defecto (J1 sirve primero)
                    gameState.player1.service = serviceBlock === 0;
                    gameState.player2.service = serviceBlock === 1;
                }
            }
        }

        // Variable para prevenir m√∫ltiples victorias de set
        let processingSetWin = false;
        let pendingSetWin = null; // Almacena info del set pendiente de confirmar
        let switchingFromHistory = false; // Prevenir clicks durante transici√≥n
        let manualServiceOverride = false; // Indica que el servicio fue cambiado manualmente
        let manualServiceStartPoint = null; // Punto total cuando se hizo el cambio manual
        let firstServer = null; // Qui√©n sirvi√≥ primero (1 o 2), determina la rotaci√≥n
        let editingScore = null; // Player number being edited (1 or 2), null if none
        let editingSets = null; // Player number being edited for sets (1 or 2), null if none

        // Editar puntos manualmente
        function editScore(player) {
            // No permitir edici√≥n durante procesamiento
            if (processingSetWin || pendingSetWin || switchingFromHistory || editingScore || editingSets) return;

            editingScore = player;
            const displayElement = document.getElementById(`player${player}ScoreDisplay`);
            const currentValue = gameState[`player${player}`].points;

            // Crear input temporal
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'score-input';
            input.value = currentValue;
            input.min = '0';
            input.max = '99';

            // Reemplazar el display con el input
            displayElement.textContent = '';
            displayElement.appendChild(input);
            displayElement.classList.add('editing');

            // Focus y seleccionar todo
            input.focus();
            input.select();

            // Funci√≥n para guardar cambios
            const saveChanges = () => {
                const newValue = parseInt(input.value) || 0;
                const validValue = Math.max(0, Math.min(99, newValue));

                gameState[`player${player}`].points = validValue;
                editingScore = null;
                displayElement.classList.remove('editing');

                updateService();
                updateDisplay();
            };

            // Guardar al presionar Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveChanges();
                } else if (e.key === 'Escape') {
                    editingScore = null;
                    displayElement.classList.remove('editing');
                    updateDisplay();
                }
            });

            // Guardar al perder foco
            input.addEventListener('blur', saveChanges);
        }

        // Editar sets manualmente
        function editSets(player) {
            // No permitir edici√≥n durante procesamiento
            if (processingSetWin || pendingSetWin || switchingFromHistory || editingScore || editingSets) return;

            editingSets = player;
            const displayElement = document.getElementById(`player${player}SetsDisplay`);
            const currentValue = gameState[`player${player}`].sets;

            // Crear input temporal
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'sets-input';
            input.value = currentValue;
            input.min = '0';
            input.max = '9';

            // Reemplazar el display con el input
            displayElement.textContent = '';
            displayElement.appendChild(input);

            // Focus y seleccionar todo
            input.focus();
            input.select();

            // Funci√≥n para guardar cambios
            const saveChanges = () => {
                const newValue = parseInt(input.value) || 0;
                const validValue = Math.max(0, Math.min(9, newValue));

                gameState[`player${player}`].sets = validValue;
                editingSets = null;

                updateDisplay();

                // Verificar si hay ganador del partido despu√©s de editar sets
                const matchWinner = checkMatchWinner();
                if (matchWinner) {
                    showMatchWinnerModal(matchWinner);
                }
            };

            // Guardar al presionar Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveChanges();
                } else if (e.key === 'Escape') {
                    editingSets = null;
                    updateDisplay();
                }
            });

            // Guardar al perder foco
            input.addEventListener('blur', saveChanges);
        }

        // Cambiar puntos
        function changePoints(player, delta) {
            // No permitir cambios si se est√° procesando una victoria de set, hay una pendiente, o estamos en transici√≥n
            if (processingSetWin || pendingSetWin || switchingFromHistory || editingScore || editingSets) return;

            // Si estamos mostrando el historial y se suma un punto, volver al marcador con delay
            if (delta > 0 && gameState.showHistoryOverlay) {
                // Bloquear para evitar m√∫ltiples clicks
                switchingFromHistory = true;

                // Primero ocultar el historial
                gameState.showHistoryOverlay = false;
                localStorage.setItem('gameState', JSON.stringify(gameState));

                // Esperar un poco para que se vea la transici√≥n antes de actualizar puntos
                setTimeout(() => {
                    const oldPoints = gameState['player' + player].points;
                    const newPoints = Math.max(0, oldPoints + delta);
                    gameState['player' + player].points = newPoints;

                    if (newPoints > oldPoints) {
                        gameState.animations['point' + player] = Date.now();

                        const otherPlayer = player === 1 ? 2 : 1;
                        const otherPoints = gameState['player' + otherPlayer].points;

                        // Verificar victoria de set
                        if (newPoints >= 11 && newPoints - otherPoints >= 2) {
                            switchingFromHistory = false;
                            showSetConfirmModal(player);
                            return;
                        }
                    }

                    updateService();
                    updateDisplay();
                    switchingFromHistory = false; // Liberar despu√©s de actualizar
                }, 400); // Esperar que termine la transici√≥n (0.4s)
                return;
            }

            const oldPoints = gameState['player' + player].points;
            const newPoints = Math.max(0, oldPoints + delta);
            gameState['player' + player].points = newPoints;

            if (delta > 0 && newPoints > oldPoints) {
                gameState.animations['point' + player] = Date.now();

                const otherPlayer = player === 1 ? 2 : 1;
                const otherPoints = gameState['player' + otherPlayer].points;

                // Verificar victoria de set
                if (newPoints >= 11 && newPoints - otherPoints >= 2) {
                    // Mostrar modal de confirmaci√≥n
                    showSetConfirmModal(player);
                    return; // No procesar autom√°ticamente
                }
            }

            updateService();
            updateDisplay();
        }

        // Mostrar modal de confirmaci√≥n de set
        function showSetConfirmModal(winnerPlayer) {
            // Guardar informaci√≥n del set pendiente Y el estado anterior
            pendingSetWin = {
                winner: winnerPlayer,
                player1Points: gameState.player1.points,
                player2Points: gameState.player2.points,
                // Guardar punto anterior para restaurar si se cancela
                previousPlayer1Points: gameState.player1.points - (winnerPlayer === 1 ? 1 : 0),
                previousPlayer2Points: gameState.player2.points - (winnerPlayer === 2 ? 1 : 0)
            };

            // Cambiar t√≠tulo seg√∫n modalidad
            const modalTitle = (gameState.gameMode === 'teams') ? 'üèÜ ¬øConfirmar Partido Ganado?' : 'üèÜ ¬øConfirmar Set Ganado?';
            document.getElementById('setModalTitle').textContent = modalTitle;

            // Obtener nombres seg√∫n modalidad
            let player1DisplayName = gameState.player1.name || 'Jugador 1';
            let player2DisplayName = gameState.player2.name || 'Jugador 2';

            if (gameState.gameMode === 'doubles') {
                player1DisplayName = gameState.doubles.team1.name || 'Pareja 1';
                player2DisplayName = gameState.doubles.team2.name || 'Pareja 2';
            } else if (gameState.gameMode === 'teams') {
                if (gameState.teams.currentMatch) {
                    player1DisplayName = `${gameState.teams.currentMatch.player1.name} (${gameState.teams.team1.name})`;
                    player2DisplayName = `${gameState.teams.currentMatch.player2.name} (${gameState.teams.team2.name})`;
                }
            }

            // Actualizar contenido del modal
            document.getElementById('modalPlayer1Name').textContent = player1DisplayName;
            document.getElementById('modalPlayer2Name').textContent = player2DisplayName;
            document.getElementById('modalPlayer1Score').textContent = gameState.player1.points;
            document.getElementById('modalPlayer2Score').textContent = gameState.player2.points;

            // Mostrar modal
            document.getElementById('setConfirmModal').classList.add('show');
        }

        // Confirmar set ganado
        function confirmSetWin() {
            if (!pendingSetWin) return;

            // Bloquear procesamiento
            processingSetWin = true;

            const player = pendingSetWin.winner;

            // Ocultar modal
            document.getElementById('setConfirmModal').classList.remove('show');

            // Guardar datos del set
            const setData = {
                player1Points: pendingSetWin.player1Points,
                player2Points: pendingSetWin.player2Points
            };

            pendingSetWin = null;

            // Actualizar display inmediatamente para mostrar el marcador
            updateDisplay();

            // DESPU√âS de 2 segundos, resetear puntos a 0-0
            setTimeout(() => {
                gameState.player1.points = 0;
                gameState.player2.points = 0;
                manualServiceOverride = false;  // Resetear override al iniciar nuevo set
                firstServer = null;  // Resetear primer servidor para el nuevo set
                updateDisplay();

                // DESPU√âS de resetear, acreditar el set con animaci√≥n
                setTimeout(() => {
                    // Guardar historial del set
                    gameState.setsHistory.push(setData);

                    // En modo equipos, incrementar individualMatchSets en lugar de sets
                    if (gameState.gameMode === 'teams') {
                        gameState.teams.individualMatchSets['player' + player]++;
                    } else {
                        // En otros modos, incrementar sets normalmente
                        gameState['player' + player].sets++;
                    }

                    // Animaci√≥n de set ganado
                    gameState.animations['set' + player] = Date.now();

                    // Actualizar para mostrar el set acreditado
                    updateDisplay();

                    // En modo equipos, verificar si se gan√≥ el partido individual
                    if (gameState.gameMode === 'teams') {
                        const individualMatchWinner = checkIndividualMatchWinner();
                        if (individualMatchWinner) {
                            // Mostrar modal de confirmaci√≥n de partido individual
                            showIndividualMatchWinnerModal(individualMatchWinner);
                        }
                    } else {
                        // En otros modos, verificar si hay ganador del partido
                        const matchWinner = checkMatchWinner();
                        if (matchWinner) {
                            // Mostrar modal de confirmaci√≥n de ganador
                            showMatchWinnerModal(matchWinner);
                        }
                    }

                    // Liberar procesamiento despu√©s de la animaci√≥n
                    setTimeout(() => {
                        processingSetWin = false;
                    }, 2000);
                }, 500);
            }, 2000);
        }

        // Cancelar set ganado
        function cancelSetWin() {
            // Ocultar modal
            document.getElementById('setConfirmModal').classList.remove('show');

            // Restaurar puntos al estado anterior (antes del √∫ltimo punto)
            if (pendingSetWin) {
                gameState.player1.points = pendingSetWin.previousPlayer1Points;
                gameState.player2.points = pendingSetWin.previousPlayer2Points;
            }

            // Limpiar set pendiente
            pendingSetWin = null;

            // Actualizar display con puntos restaurados
            updateDisplay();
        }

        // Cambiar sets
        function changeSets(player, delta) {
            const newValue = Math.max(0, gameState['player' + player].sets + delta);

            // Validar que no se exceda el l√≠mite de sets necesarios para ganar
            const setsToWin = getSetsToWin();
            const otherPlayer = player === 1 ? 2 : 1;
            const otherPlayerSets = gameState['player' + otherPlayer].sets;

            // Si estamos sumando (+1) y el jugador ya alcanzar√≠a los sets para ganar, mostrar modal
            if (delta > 0 && newValue >= setsToWin) {
                // Verificar que el otro jugador no tenga tambi√©n sets suficientes
                if (otherPlayerSets < setsToWin) {
                    gameState['player' + player].sets = newValue;
                    updateDisplay();
                    // Mostrar modal de ganador
                    showMatchWinnerModal(player);
                    return;
                }
            }

            gameState['player' + player].sets = newValue;
            updateDisplay();
        }

        // Cambiar servicio manualmente
        function setService(player) {
            const totalPoints = gameState.player1.points + gameState.player2.points;

            gameState.player1.service = player === 1;
            gameState.player2.service = player === 2;
            gameState.animations.service = Date.now();
            manualServiceOverride = true; // Marcar que fue cambiado manualmente
            manualServiceStartPoint = totalPoints; // Guardar punto actual

            // Si estamos en 0-0 o 0-1 (inicio del set), guardar qui√©n sirve primero
            if (totalPoints <= 1 && firstServer === null) {
                firstServer = player;
            }

            updateDisplay();
        }

        // Cambiar color de fondo
        function setBackground(type) {
            const colorMap = {
                'green': '#00FF00',
                'blue': '#0000FF',
                'magenta': '#FF00FF',
                'red': '#FF0000'
            };

            if (type === 'gradient') {
                gameState.background = { type: 'gradient', color: '#00FF00' };
            } else if (type === 'transparent') {
                gameState.background = { type: 'transparent', color: '#00FF00' };
            } else {
                gameState.background = { type: 'solid', color: colorMap[type] };
            }
            updateDisplay();
        }

        // Cambiar tema
        function setTheme(themeName) {
            if (themes[themeName]) {
                gameState.theme = themeName;
                updateDisplay();
            }
        }

        // Actualizar botones de tema activos
        function updateThemeButtons() {
            document.querySelectorAll('.btn-theme').forEach(btn => btn.classList.remove('active'));

            const themeMap = {
                'azulModerno': 'themeAzulModerno',
                'oscuroElegante': 'themeOscuroElegante',
                'claroMinimalista': 'themeClaroMinimalista',
                'neonNocturno': 'themeNeonNocturno',
                'doradoPremium': 'themeDoradoPremium',
                'verdeDeportivo': 'themeVerdeDeportivo'
            };

            const activeThemeId = themeMap[gameState.theme || 'azulModerno'];
            const activeBtn = document.getElementById(activeThemeId);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        // Cambiar modo de partido
        function setMatchMode(mode) {
            gameState.matchMode = mode;
            updateDisplay();
        }

        // Activar/desactivar animaciones
        function setAnimations(enabled) {
            if (!gameState.winner) {
                gameState.winner = { detected: false, player: null, finalScore: '', showOverlay: false, emoji: 'üèÜ' };
            }
            gameState.winner.animationsEnabled = enabled;
            updateDisplay();
        }

        // Cambiar emoji de celebraci√≥n
        function setWinnerEmoji(emoji) {
            if (!gameState.winner) {
                gameState.winner = { detected: false, player: null, finalScore: '', showOverlay: false, emoji: 'üèÜ' };
            }
            gameState.winner.emoji = emoji;

            // Actualizar botones activos
            const emojiMap = {
                'üèÜ': 'emojiTrophy',
                'ü•á': 'emojiMedal',
                'üèÖ': 'emojiCup',
                '‚≠ê': 'emojiStar',
                'üëë': 'emojiCrown'
            };

            // Remover active de todos
            Object.values(emojiMap).forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.classList.remove('active');
            });

            // Activar el seleccionado
            const activeId = emojiMap[emoji];
            if (activeId) {
                const btn = document.getElementById(activeId);
                if (btn) btn.classList.add('active');
            }

            updateDisplay();
        }

        // Obtener n√∫mero de sets necesarios para ganar
        function getSetsToWin() {
            const modeMap = {
                'best-of-3': 2,
                'best-of-5': 3,
                'best-of-7': 4
            };
            return modeMap[gameState.matchMode] || 3;
        }

        // Actualizar botones de modo de partido
        function updateMatchModeButtons() {
            document.getElementById('modeBest3').classList.toggle('active', gameState.matchMode === 'best-of-3');
            document.getElementById('modeBest5').classList.toggle('active', gameState.matchMode === 'best-of-5');
            document.getElementById('modeBest7').classList.toggle('active', gameState.matchMode === 'best-of-7');

            // Actualizar label
            const setsToWin = getSetsToWin();
            const modeNames = {
                'best-of-3': 'Mejor de 3',
                'best-of-5': 'Mejor de 5',
                'best-of-7': 'Mejor de 7'
            };
            const modeName = modeNames[gameState.matchMode] || 'Mejor de 5';
            document.getElementById('setsToWinLabel').textContent = `${modeName} - Primero en ganar ${setsToWin} sets`;
        }

        // Actualizar botones de animaciones
        function updateAnimationsButtons() {
            const animationsEnabled = gameState.winner && gameState.winner.animationsEnabled !== false;
            document.getElementById('animationsOn').classList.toggle('active', animationsEnabled);
            document.getElementById('animationsOff').classList.toggle('active', !animationsEnabled);
        }

        // Actualizar botones de emoji de celebraci√≥n
        function updateWinnerEmojiButtons() {
            const currentEmoji = (gameState.winner && gameState.winner.emoji) || 'üèÜ';
            const emojiMap = {
                'üèÜ': 'emojiTrophy',
                'ü•á': 'emojiMedal',
                'üèÖ': 'emojiCup',
                '‚≠ê': 'emojiStar',
                'üëë': 'emojiCrown'
            };

            // Remover active de todos
            Object.values(emojiMap).forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.classList.remove('active');
            });

            // Activar el seleccionado
            const activeId = emojiMap[currentEmoji];
            if (activeId) {
                const btn = document.getElementById(activeId);
                if (btn) btn.classList.add('active');
            }
        }

        // Detectar ganador del partido
        function checkMatchWinner() {
            const setsToWin = getSetsToWin();

            if (gameState.player1.sets >= setsToWin) {
                return 1;
            } else if (gameState.player2.sets >= setsToWin) {
                return 2;
            }
            return null;
        }

        // Verificar ganador de partido individual en modo equipos
        function checkIndividualMatchWinner() {
            if (gameState.gameMode !== 'teams') return null;

            const setsToWin = getSetsToWin();

            if (gameState.teams.individualMatchSets.player1 >= setsToWin) {
                return 1;
            } else if (gameState.teams.individualMatchSets.player2 >= setsToWin) {
                return 2;
            }
            return null;
        }

        // Variable para almacenar info del ganador pendiente
        let pendingMatchWinner = null;
        let pendingIndividualMatchWinner = null;

        // Mostrar modal de confirmaci√≥n de ganador del partido
        function showMatchWinnerModal(winnerPlayer) {
            // Guardar info del ganador
            pendingMatchWinner = {
                winner: winnerPlayer
            };

            // Obtener nombres y banderas seg√∫n modalidad
            let winnerName = '';
            let winnerFlagCode = '';
            let player1DisplayName = '';
            let player2DisplayName = '';

            if (gameState.gameMode === 'individual') {
                const winnerData = gameState[`player${winnerPlayer}`];
                winnerName = winnerData.name;
                winnerFlagCode = getISO2Code(winnerData.flag);
                player1DisplayName = gameState.player1.name || 'Jugador 1';
                player2DisplayName = gameState.player2.name || 'Jugador 2';
            } else if (gameState.gameMode === 'doubles') {
                const winnerTeam = gameState.doubles[`team${winnerPlayer}`];
                winnerName = winnerTeam.name || `Pareja ${winnerPlayer}`;
                winnerFlagCode = getISO2Code(winnerTeam.flag);
                player1DisplayName = gameState.doubles.team1.name || 'Pareja 1';
                player2DisplayName = gameState.doubles.team2.name || 'Pareja 2';
            } else if (gameState.gameMode === 'teams') {
                const winnerTeam = gameState.teams[`team${winnerPlayer}`];
                winnerName = winnerTeam.name || `Equipo ${winnerPlayer}`;
                player1DisplayName = gameState.teams.team1.name || 'Equipo 1';
                player2DisplayName = gameState.teams.team2.name || 'Equipo 2';
                // Usar bandera del equipo ganador (del jugador actual)
                if (gameState.teams.currentMatch) {
                    winnerFlagCode = getISO2Code(gameState.teams.currentMatch[`player${winnerPlayer}`].flag);
                } else {
                    winnerFlagCode = 'es';
                }
            }

            // Actualizar contenido del modal
            document.getElementById('matchWinnerName').textContent = winnerName;

            // Actualizar bandera usando flag-icons
            const flagElement = document.getElementById('matchWinnerFlag');
            flagElement.className = `fi fi-${winnerFlagCode}`;

            document.getElementById('matchModalPlayer1Name').textContent = player1DisplayName;
            document.getElementById('matchModalPlayer2Name').textContent = player2DisplayName;
            // Mostrar sets actuales (ya fueron incrementados)
            document.getElementById('matchModalPlayer1Sets').textContent = gameState.player1.sets;
            document.getElementById('matchModalPlayer2Sets').textContent = gameState.player2.sets;

            // Mostrar modal
            document.getElementById('matchWinnerModal').classList.add('show');
        }

        // Mostrar modal de confirmaci√≥n de partido individual ganado (modo equipos)
        function showIndividualMatchWinnerModal(winnerPlayer) {
            // Guardar info del ganador
            pendingIndividualMatchWinner = {
                winner: winnerPlayer
            };

            // Obtener nombres del partido actual
            const player1Name = gameState.teams.currentMatch.player1.name || 'Jugador 1';
            const player2Name = gameState.teams.currentMatch.player2.name || 'Jugador 2';
            const winnerName = winnerPlayer === 1 ? player1Name : player2Name;
            const winnerFlagCode = getISO2Code(gameState.teams.currentMatch[`player${winnerPlayer}`].flag);
            const winnerCountryName = gameState.teams[`team${winnerPlayer}`].name || `Equipo ${winnerPlayer}`;

            // Actualizar contenido del modal
            document.getElementById('individualMatchWinnerName').textContent = winnerName;
            document.getElementById('individualMatchWinnerCountry').textContent = winnerCountryName;

            // Actualizar bandera usando flag-icons
            const flagElement = document.getElementById('individualMatchWinnerFlag');
            flagElement.className = `fi fi-${winnerFlagCode}`;

            document.getElementById('individualMatchModalPlayer1Name').textContent = player1Name;
            document.getElementById('individualMatchModalPlayer2Name').textContent = player2Name;
            // Mostrar sets del partido individual actual
            document.getElementById('individualMatchModalPlayer1Sets').textContent = gameState.teams.individualMatchSets.player1;
            document.getElementById('individualMatchModalPlayer2Sets').textContent = gameState.teams.individualMatchSets.player2;

            // Mostrar modal
            document.getElementById('individualMatchWinnerModal').classList.add('show');
        }

        // Confirmar ganador del partido
        function confirmMatchWin() {
            if (!pendingMatchWinner) return;

            const winnerPlayer = pendingMatchWinner.winner;

            // Ocultar modal
            document.getElementById('matchWinnerModal').classList.remove('show');

            // Guardar informaci√≥n del ganador
            if (!gameState.winner) {
                gameState.winner = {};
            }
            gameState.winner.detected = true;
            gameState.winner.player = winnerPlayer;

            // En modo equipos, mostrar puntos del pa√≠s; en otros modos, mostrar sets
            if (gameState.gameMode === 'teams') {
                gameState.winner.finalScore = `${gameState.teams.countryPoints.team1}-${gameState.teams.countryPoints.team2}`;
            } else {
                gameState.winner.finalScore = `${gameState.player1.sets}-${gameState.player2.sets}`;
            }

            gameState.winner.showOverlay = true;

            pendingMatchWinner = null;

            updateDisplay();

            // Ocultar autom√°ticamente despu√©s de 7 segundos y cambiar a historial
            setTimeout(() => {
                if (gameState.winner && gameState.winner.showOverlay) {
                    gameState.winner.showOverlay = false;

                    // Cambiar a la pesta√±a de configuraci√≥n (que muestra el historial)
                    switchTab('config');

                    // Actualizar despu√©s del cambio de tab
                    updateDisplay();
                }
            }, 7000);
        }

        // Cancelar ganador del partido
        function cancelMatchWin() {
            // Ocultar modal
            document.getElementById('matchWinnerModal').classList.remove('show');

            // Limpiar ganador pendiente
            pendingMatchWinner = null;

            // No revertir nada - el set ya fue confirmado y es v√°lido
            // El usuario puede editar manualmente los sets si se equivoc√≥ en la configuraci√≥n
            updateDisplay();
        }

        // Confirmar ganador del partido individual (modo equipos)
        function confirmIndividualMatchWin() {
            if (!pendingIndividualMatchWinner) return;

            const winnerPlayer = pendingIndividualMatchWinner.winner;

            // Ocultar modal
            document.getElementById('individualMatchWinnerModal').classList.remove('show');

            // Incrementar puntos del pa√≠s ganador
            gameState.teams.countryPoints[`team${winnerPlayer}`]++;

            // Resetear sets del partido individual para el siguiente partido
            gameState.teams.individualMatchSets.player1 = 0;
            gameState.teams.individualMatchSets.player2 = 0;

            // Resetear puntos
            gameState.player1.points = 0;
            gameState.player2.points = 0;

            // Limpiar historial de sets para el siguiente partido individual
            gameState.setsHistory = [];

            pendingIndividualMatchWinner = null;

            updateDisplay();

            // Verificar si hay ganador del encuentro (pa√≠s ganador)
            const encounterWinner = checkEncounterWinner();
            if (encounterWinner) {
                // Mostrar modal de ganador del encuentro
                showMatchWinnerModal(encounterWinner);
            } else {
                // Mostrar mensaje para cambiar jugadores
                setTimeout(() => {
                    alert('üí° Partido completado!\n\n1. Oculta el marcador del overlay\n2. Ve a Configuraci√≥n para cambiar los jugadores del siguiente partido\n3. Usa el bot√≥n "Siguiente Partido" cuando est√©s listo');
                }, 500);
            }
        }

        // Cancelar ganador del partido individual
        function cancelIndividualMatchWin() {
            // Ocultar modal
            document.getElementById('individualMatchWinnerModal').classList.remove('show');

            // Limpiar ganador pendiente
            pendingIndividualMatchWinner = null;

            // No revertir nada - los sets ya fueron confirmados
            updateDisplay();
        }

        // Verificar ganador del encuentro (en modo equipos)
        function checkEncounterWinner() {
            if (gameState.gameMode !== 'teams') return null;

            const setsToWin = getSetsToWin();

            if (gameState.teams.countryPoints.team1 >= setsToWin) {
                return 1;
            } else if (gameState.teams.countryPoints.team2 >= setsToWin) {
                return 2;
            }
            return null;
        }

        // Actualizar historial de sets
        function updateSetsHistory() {
            const container = document.getElementById('setsHistoryContainer');
            const list = document.getElementById('setsHistoryList');

            if (gameState.setsHistory && gameState.setsHistory.length > 0) {
                container.style.display = 'block';

                let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
                gameState.setsHistory.forEach((set, index) => {
                    const winner = set.player1Points > set.player2Points ? 1 : 2;
                    const winnerStyle = winner === 1 ? 'color: #667eea; font-weight: 700;' : 'color: #764ba2; font-weight: 700;';

                    html += `<div style="display: flex; justify-content: space-between; padding: 4px 8px; background: white; border-radius: 4px;">
                        <span>Set ${index + 1}:</span>
                        <span style="${winnerStyle}">${set.player1Points} - ${set.player2Points}</span>
                    </div>`;
                });
                html += '</div>';
                list.innerHTML = html;
            } else {
                container.style.display = 'none';
            }
        }

        // Funciones del Logo
        function updateLogoUI() {
            const logo = gameState.logo || { url: '', position: 'left', enabled: false };

            document.getElementById('logoUrl').value = logo.url || '';
            document.getElementById('logoLeft').classList.toggle('active', logo.position === 'left');
            document.getElementById('logoRight').classList.toggle('active', logo.position === 'right');

            const toggleBtn = document.getElementById('logoToggle');
            toggleBtn.textContent = logo.enabled ? '‚úÖ Activado' : 'üö´ Desactivado';
            toggleBtn.classList.toggle('active', logo.enabled);

            const preview = document.getElementById('logoPreviewImg');
            if (logo.url) {
                preview.src = logo.url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function updateLogoUrl() {
            const url = document.getElementById('logoUrl').value;
            if (!gameState.logo) gameState.logo = { position: 'left', enabled: false };
            gameState.logo.url = url;
            // Activar autom√°ticamente si hay URL
            if (url && url.trim()) {
                gameState.logo.enabled = true;
            }
            updateDisplay();
        }

        function setLogoPosition(position) {
            if (!gameState.logo) gameState.logo = { url: '', enabled: false };
            gameState.logo.position = position;
            updateDisplay();
        }

        function toggleLogo() {
            if (!gameState.logo) gameState.logo = { url: '', position: 'left' };
            gameState.logo.enabled = !gameState.logo.enabled;
            updateDisplay();
        }

        function handleLogoFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (!gameState.logo) gameState.logo = { position: 'left', enabled: false };
                    gameState.logo.url = e.target.result;
                    // Activar autom√°ticamente cuando se sube un archivo
                    gameState.logo.enabled = true;
                    updateDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        // Reiniciar todo
        function resetAll() {
            if (confirm('¬øResetear puntos y sets a 0?')) {
                gameState.player1.points = 0;
                gameState.player2.points = 0;
                gameState.player1.sets = 0;
                gameState.player2.sets = 0;
                gameState.player1.service = true;
                gameState.player2.service = false;
                gameState.setsHistory = [];  // Limpiar historial
                gameState.winner = {         // Limpiar ganador
                    detected: false,
                    player: null,
                    finalScore: ''
                };
                // Resetear marcadores de equipos
                if (gameState.teams && gameState.teams.individualMatchSets) {
                    gameState.teams.individualMatchSets.player1 = 0;
                    gameState.teams.individualMatchSets.player2 = 0;
                }
                if (gameState.teams && gameState.teams.countryPoints) {
                    gameState.teams.countryPoints.team1 = 0;
                    gameState.teams.countryPoints.team2 = 0;
                }
                manualServiceOverride = false;  // Resetear override manual
                firstServer = null;  // Resetear primer servidor
                updateDisplay();
            }
        }

        // Siguiente partido (modo equipos)
        function nextMatch() {
            if (confirm('¬øIniciar siguiente partido? (Los sets se mantienen, los puntos se resetean a 0)')) {
                // Solo resetear puntos, mantener sets
                gameState.player1.points = 0;
                gameState.player2.points = 0;
                gameState.player1.service = true;
                gameState.player2.service = false;

                // Resetear override manual de servicio
                manualServiceOverride = false;
                firstServer = null;

                // Ocultar ganador del partido anterior si estaba visible
                if (gameState.winner && gameState.winner.showOverlay) {
                    gameState.winner.showOverlay = false;
                }

                updateDisplay();

                // Mensaje de ayuda
                alert('üí° Listo para el siguiente partido!\n\nRecuerda cambiar los nombres de los jugadores en la pesta√±a Configuraci√≥n.');
            }
        }

        // Escuchar cambios desde el overlay
        window.addEventListener('storage', (e) => {
            if (e.key === 'gameState') {
                gameState = JSON.parse(e.newValue);
                if (!gameState.animations) {
                    gameState.animations = {
                        point1: 0,
                        point2: 0,
                        set1: 0,
                        set2: 0,
                        service: 0
                    };
                }
                updateDisplay();
            }
        });

        // Cargar estado al iniciar
        loadState();

        // ==================== SISTEMA DE AUTOSUGERENCIA ====================

        // Estado del autocompletado
        function isAutocompleteEnabled() {
            const enabled = localStorage.getItem('autocompleteEnabled');
            return enabled === null ? true : enabled === 'true';
        }

        function setAutocompleteEnabled(enabled) {
            localStorage.setItem('autocompleteEnabled', enabled.toString());

            // Actualizar UI de botones
            const onBtn = document.getElementById('autocompleteOn');
            const offBtn = document.getElementById('autocompleteOff');

            if (enabled) {
                onBtn.classList.add('active');
                offBtn.classList.remove('active');
            } else {
                onBtn.classList.remove('active');
                offBtn.classList.add('active');
            }
        }

        // Base de datos de jugadores en localStorage
        function getPlayersDatabase() {
            const data = localStorage.getItem('playersDatabase');
            return data ? JSON.parse(data) : [];
        }

        function savePlayersDatabase(players) {
            localStorage.setItem('playersDatabase', JSON.stringify(players));
            updatePlayersDbStatus();
        }

        function updatePlayersDbStatus() {
            const players = getPlayersDatabase();
            const statusDiv = document.getElementById('playersDbStatus');
            const clearBtn = document.getElementById('clearPlayersDb');
            const countSpan = document.getElementById('playersCount');
            const toggleContainer = document.getElementById('autocompleteToggleContainer');

            if (players.length > 0) {
                statusDiv.style.display = 'block';
                clearBtn.style.display = 'block';
                toggleContainer.style.display = 'block';
                countSpan.textContent = players.length;

                // Actualizar estado de botones toggle
                const enabled = isAutocompleteEnabled();
                setAutocompleteEnabled(enabled);
            } else {
                statusDiv.style.display = 'none';
                clearBtn.style.display = 'none';
                toggleContainer.style.display = 'none';
            }
        }

        // Manejar carga de CSV
        function handleCSVFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                const players = [];

                for (let line of lines) {
                    line = line.trim();
                    if (!line) continue;

                    const parts = line.split(',').map(p => p.trim());
                    if (parts.length >= 2) {
                        players.push({
                            name: parts[0],
                            flag: parts[1].toUpperCase(),
                            country: parts[2] || ''
                        });
                    }
                }

                if (players.length > 0) {
                    savePlayersDatabase(players);
                    alert(`‚úÖ ${players.length} jugadores cargados exitosamente`);
                } else {
                    alert('‚ùå No se encontraron jugadores v√°lidos en el archivo CSV');
                }
            };
            reader.readAsText(file);

            // Reset input para permitir cargar el mismo archivo
            event.target.value = '';
        }

        // Limpiar base de datos
        function clearPlayersDatabase() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar todos los jugadores de la base de datos?')) {
                localStorage.removeItem('playersDatabase');
                updatePlayersDbStatus();
                alert('‚úÖ Base de datos limpiada');
            }
        }

        // Buscar jugadores que coincidan con el texto
        function searchPlayers(query) {
            if (!query || query.length < 2) return [];

            const players = getPlayersDatabase();
            const lowerQuery = query.toLowerCase();

            return players.filter(player =>
                player.name.toLowerCase().includes(lowerQuery)
            );
        }

        // Mostrar lista de autocompletado
        function showAutocomplete(inputElement, playerNumber, matches) {
            const listElement = document.getElementById(`autocomplete${playerNumber}`);

            if (matches.length === 0) {
                listElement.classList.remove('active');
                return;
            }

            listElement.innerHTML = '';
            matches.forEach(player => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                item.innerHTML = `
                    <span>${player.name}</span>
                    <span class="flag-code">${player.flag}</span>
                    ${player.country ? `<span class="country">(${player.country})</span>` : ''}
                `;

                // Usar mousedown en lugar de click para que se ejecute antes del blur
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    selectPlayer(inputElement, playerNumber, player);
                });

                listElement.appendChild(item);
            });

            listElement.classList.add('active');
        }

        // Ocultar lista de autocompletado
        function hideAutocomplete(playerNumber) {
            setTimeout(() => {
                const listElement = document.getElementById(`autocomplete${playerNumber}`);
                if (listElement) {
                    listElement.classList.remove('active');
                }
            }, 200);
        }

        // Seleccionar un jugador del autocompletado
        function selectPlayer(inputElement, playerNumber, player) {
            inputElement.value = player.name;

            // Actualizar el campo de bandera correspondiente
            let flagInputId;
            if (inputElement.id === 'player1Name') {
                flagInputId = 'player1Flag';
            } else if (inputElement.id === 'player2Name') {
                flagInputId = 'player2Flag';
            } else if (inputElement.id === 'teamsCurrentPlayer1') {
                flagInputId = 'teamsCurrentFlag1';
            } else if (inputElement.id === 'teamsCurrentPlayer2') {
                flagInputId = 'teamsCurrentFlag2';
            }

            if (flagInputId) {
                const flagInput = document.getElementById(flagInputId);
                if (flagInput) {
                    flagInput.value = player.flag;
                }
            }

            // Actualizar datos
            updateData();

            // Ocultar lista
            hideAutocomplete(playerNumber);
        }

        // Manejar input en campo de autocompletado
        function handleAutocomplete(inputElement, playerNumber) {
            // Verificar si el autocompletado est√° habilitado
            if (!isAutocompleteEnabled()) {
                return;
            }

            const query = inputElement.value;
            const matches = searchPlayers(query);
            showAutocomplete(inputElement, playerNumber, matches);
        }

        // Manejar focus para mostrar todos los jugadores
        function handleAutocompleteFocus(inputElement, playerNumber) {
            // Verificar si el autocompletado est√° habilitado
            if (!isAutocompleteEnabled()) {
                return;
            }

            const players = getPlayersDatabase();
            if (players.length > 0 && !inputElement.value) {
                showAutocomplete(inputElement, playerNumber, players);
            }
        }

        // Inicializar estado de la base de datos al cargar
        updatePlayersDbStatus();
    </script>
</body>
</html>
