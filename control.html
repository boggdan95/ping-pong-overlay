<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 700;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }

        .tab-button {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid transparent;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-color: #667eea;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== TAB PARTIDO ==================== */

        .match-header {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .visibility-toggle {
            flex: 2;
            background: #2196F3;
            color: white;
            padding: 10px;
            font-size: 13px;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .visibility-toggle:hover {
            background: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .visibility-toggle.hidden {
            background: #f44336;
        }

        .visibility-toggle.hidden:hover {
            background: #d32f2f;
        }

        .btn-reset-match {
            flex: 1;
            background: #ff9800;
            color: white;
            padding: 10px;
            font-size: 12px;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-reset-match:hover {
            background: #ff6f00;
            transform: translateY(-1px);
        }

        .players-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .player-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .player-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .player-name-display {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-flag-display {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .score-display {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }

        .sets-display {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .point-buttons {
            display: flex;
            gap: 6px;
        }

        .btn-point {
            flex: 1;
            padding: 12px 8px;
            border: none;
            border-radius: 6px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-point-minus {
            background: #f44336;
            color: white;
        }

        .btn-point-minus:hover {
            background: #da190b;
            transform: scale(1.05);
        }

        .btn-point-plus {
            background: #4CAF50;
            color: white;
        }

        .btn-point-plus:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .service-indicator {
            margin-top: 8px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .player-card.active .service-indicator {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
        }

        .service-indicator:hover {
            transform: scale(1.02);
        }

        /* ==================== TAB CONFIGURACIÓN ==================== */

        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .config-section h3 {
            font-size: 12px;
            color: #667eea;
            margin-bottom: 8px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 4px;
            color: #555;
            font-size: 11px;
            text-transform: uppercase;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f5ff;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .btn-color {
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-color:hover {
            transform: scale(1.05);
        }

        .btn-color.active {
            border-color: #667eea;
            border-width: 3px;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.6);
        }

        .btn-color.green { background: #00FF00; color: #000; }
        .btn-color.blue { background: #0000FF; color: #fff; }
        .btn-color.magenta { background: #FF00FF; color: #fff; }
        .btn-color.red { background: #FF0000; color: #fff; }
        .btn-color.gradient {
            background: linear-gradient(135deg, #003d8c 0%, #0052CC 100%);
            color: #fff;
        }
        .btn-color.transparent {
            background: repeating-linear-gradient(
                45deg,
                #ccc,
                #ccc 10px,
                #fff 10px,
                #fff 20px
            );
            color: #000;
        }

        .logo-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .logo-url-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }

        .logo-file-btn {
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .logo-options {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .btn-logo-option {
            flex: 1;
            padding: 8px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-logo-option:hover {
            border-color: #667eea;
        }

        .btn-logo-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .logo-preview {
            text-align: center;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 60px;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            body {
                padding: 6px;
            }

            .container {
                max-width: 100%;
            }

            h1 {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .tab-button {
                padding: 6px;
                font-size: 11px;
            }

            .panel {
                padding: 8px;
            }

            .score-display {
                font-size: 28px;
            }

            .player-name-display {
                font-size: 11px;
            }

            .player-flag-display {
                font-size: 20px;
            }

            .btn-point {
                font-size: 18px;
                padding: 10px 6px;
            }
        }

        /* Ultra compacto para cuarto de pantalla (960x540 o menos) */
        @media (max-width: 500px) {
            body {
                padding: 4px;
            }

            h1 {
                font-size: 13px;
                margin-bottom: 4px;
            }

            .tabs {
                gap: 4px;
                margin-bottom: 6px;
            }

            .tab-button {
                padding: 6px 4px;
                font-size: 10px;
            }

            .panel {
                padding: 6px;
                border-radius: 6px;
            }

            .match-header {
                gap: 4px;
                margin-bottom: 6px;
            }

            .visibility-toggle,
            .btn-reset-match {
                padding: 8px;
                font-size: 11px;
            }

            .players-grid {
                gap: 6px;
            }

            .player-card {
                padding: 8px;
            }

            .player-name-display {
                font-size: 10px;
                margin-bottom: 4px;
            }

            .player-flag-display {
                font-size: 18px;
                margin-bottom: 6px;
            }

            .score-display {
                font-size: 24px;
                margin-bottom: 6px;
            }

            .sets-display {
                font-size: 9px;
                margin-bottom: 6px;
            }

            .point-buttons {
                gap: 4px;
            }

            .btn-point {
                padding: 10px 4px;
                font-size: 16px;
            }

            .service-indicator {
                margin-top: 6px;
                padding: 4px;
                font-size: 9px;
            }

            .config-section {
                padding: 8px;
                margin-bottom: 8px;
            }

            .config-section h3 {
                font-size: 10px;
            }

            .form-group input {
                padding: 6px;
                font-size: 12px;
            }

            .btn-color {
                padding: 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏓 Control Panel</h1>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('match')">
                🏓 Partido
            </button>
            <button class="tab-button" onclick="switchTab('config')">
                ⚙️ Configuración
            </button>
        </div>

        <div class="panel">
            <!-- TAB: PARTIDO -->
            <div id="matchTab" class="tab-content active">
                <div class="match-header">
                    <button id="visibilityToggle" class="visibility-toggle" onclick="toggleOverlayVisibility()">
                        👁️ Mostrar Overlay
                    </button>
                    <button class="btn-reset-match" onclick="resetAll()">
                        🔄 Reset
                    </button>
                </div>

                <div class="players-grid">
                    <!-- Jugador 1 -->
                    <div class="player-card" id="playerCard1">
                        <div class="player-name-display" id="player1NameDisplay">Jugador 1</div>
                        <div class="player-flag-display">
                            <span class="fi fi-es" id="player1FlagDisplay"></span>
                        </div>
                        <div class="score-display" id="player1ScoreDisplay">0</div>
                        <div class="sets-display">Sets: <span id="player1SetsDisplay">0</span></div>
                        <div class="point-buttons">
                            <button class="btn-point btn-point-minus" onclick="changePoints(1, -1)">−</button>
                            <button class="btn-point btn-point-plus" onclick="changePoints(1, 1)">+</button>
                        </div>
                        <div class="service-indicator" onclick="setService(1)">
                            🎾 Servicio
                        </div>
                    </div>

                    <!-- Jugador 2 -->
                    <div class="player-card" id="playerCard2">
                        <div class="player-name-display" id="player2NameDisplay">Jugador 2</div>
                        <div class="player-flag-display">
                            <span class="fi fi-ar" id="player2FlagDisplay"></span>
                        </div>
                        <div class="score-display" id="player2ScoreDisplay">0</div>
                        <div class="sets-display">Sets: <span id="player2SetsDisplay">0</span></div>
                        <div class="point-buttons">
                            <button class="btn-point btn-point-minus" onclick="changePoints(2, -1)">−</button>
                            <button class="btn-point btn-point-plus" onclick="changePoints(2, 1)">+</button>
                        </div>
                        <div class="service-indicator" onclick="setService(2)">
                            🎾 Servicio
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: CONFIGURACIÓN -->
            <div id="configTab" class="tab-content">
                <!-- Jugadores -->
                <div class="config-section">
                    <h3>👥 Jugadores</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Jugador 1</label>
                            <input type="text" id="player1Name" value="Héctor López" onchange="updateData()">
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="player1Flag" value="ESP" maxlength="3" onchange="updateData()" placeholder="ESP" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Jugador 2</label>
                            <input type="text" id="player2Name" value="Susana Martínez" onchange="updateData()">
                        </div>
                        <div class="form-group">
                            <label>Bandera (3 letras)</label>
                            <input type="text" id="player2Flag" value="ARG" maxlength="3" onchange="updateData()" placeholder="ARG" style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>

                <!-- Color de Fondo -->
                <div class="config-section">
                    <h3>🎨 Color de Fondo (Chroma Key)</h3>
                    <div class="color-grid">
                        <button class="btn-color green active" onclick="setBackground('green')" id="bgGreen">
                            🟢 Verde
                        </button>
                        <button class="btn-color blue" onclick="setBackground('blue')" id="bgBlue">
                            🔵 Azul
                        </button>
                        <button class="btn-color magenta" onclick="setBackground('magenta')" id="bgMagenta">
                            🟣 Magenta
                        </button>
                        <button class="btn-color red" onclick="setBackground('red')" id="bgRed">
                            🔴 Rojo
                        </button>
                        <button class="btn-color gradient" onclick="setBackground('gradient')" id="bgGradient">
                            🌈 Degradado
                        </button>
                        <button class="btn-color transparent" onclick="setBackground('transparent')" id="bgTransparent">
                            ⚪ Transparente
                        </button>
                    </div>
                </div>

                <!-- Logo -->
                <div class="config-section">
                    <h3>🖼️ Logo</h3>
                    <div class="logo-input-group">
                        <input type="text" id="logoUrl" class="logo-url-input" placeholder="URL del logo o pega imagen" onchange="updateLogoUrl()">
                        <input type="file" id="logoFile" accept="image/*" style="display: none;" onchange="handleLogoFile(event)">
                        <button class="logo-file-btn" onclick="document.getElementById('logoFile').click()">📁 Subir</button>
                    </div>
                    <div class="logo-options">
                        <button class="btn-logo-option active" id="logoLeft" onclick="setLogoPosition('left')">⬅️ Izquierda</button>
                        <button class="btn-logo-option" id="logoRight" onclick="setLogoPosition('right')">Derecha ➡️</button>
                        <button class="btn-logo-option" id="logoToggle" onclick="toggleLogo()">🚫 Desactivado</button>
                    </div>
                    <div id="logoPreview" class="logo-preview">
                        <img id="logoPreviewImg" src="" alt="Vista previa del logo">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mapeo de códigos de 3 letras a códigos ISO 3166-1 alpha-2
        const countryCodeMap = {
            'GUA': 'gt', 'ESA': 'sv', 'NCA': 'ni', 'HON': 'hn', 'PAN': 'pa',
            'CRC': 'cr', 'BLZ': 'bz', 'MEX': 'mx', 'USA': 'us', 'CAN': 'ca',
            'ESP': 'es', 'ARG': 'ar', 'BRA': 'br', 'CHI': 'cl', 'COL': 'co',
            'URU': 'uy', 'VEN': 've', 'PER': 'pe', 'ECU': 'ec', 'BOL': 'bo',
            'PAR': 'py', 'CUB': 'cu', 'DOM': 'do', 'PRI': 'pr', 'JAM': 'jm',
            'CHN': 'cn', 'JPN': 'jp', 'KOR': 'kr', 'IND': 'in', 'THA': 'th',
            'FRA': 'fr', 'GER': 'de', 'ITA': 'it', 'GBR': 'gb', 'POR': 'pt',
            'NED': 'nl', 'BEL': 'be', 'SWE': 'se', 'NOR': 'no', 'DEN': 'dk',
            'AUS': 'au', 'NZL': 'nz', 'RSA': 'za', 'EGY': 'eg', 'NGA': 'ng'
        };

        // Función para convertir código de 3 letras a código ISO de 2 letras
        function getISO2Code(code3) {
            return countryCodeMap[code3.toUpperCase()] || code3.toLowerCase().slice(0, 2);
        }

        // Estado global
        let gameState = {
            player1: { name: 'Héctor López', points: 0, sets: 0, service: true, flag: 'ESP' },
            player2: { name: 'Susana Martínez', points: 0, sets: 0, service: false, flag: 'ARG' },
            background: {
                type: 'solid',
                color: '#00FF00'
            },
            logo: {
                url: '',
                position: 'left',
                enabled: false
            },
            overlayVisible: true,
            animations: {
                point1: 0,
                point2: 0,
                set1: 0,
                set2: 0,
                service: 0
            }
        };

        // Cambiar entre tabs
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            if (tabName === 'match') {
                document.getElementById('matchTab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else if (tabName === 'config') {
                document.getElementById('configTab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
            }
        }

        // Cargar estado
        function loadState() {
            const saved = localStorage.getItem('gameState');
            if (saved) {
                gameState = JSON.parse(saved);

                // Asegurar que exista el campo animations
                if (!gameState.animations) {
                    gameState.animations = {
                        point1: 0,
                        point2: 0,
                        set1: 0,
                        set2: 0,
                        service: 0
                    };
                }
            }
            updateDisplay();
        }

        // Actualizar pantalla
        function updateDisplay() {
            // Tab Configuración
            document.getElementById('player1Name').value = gameState.player1.name;
            document.getElementById('player2Name').value = gameState.player2.name;
            document.getElementById('player1Flag').value = gameState.player1.flag;
            document.getElementById('player2Flag').value = gameState.player2.flag;

            // Tab Partido - Display
            document.getElementById('player1NameDisplay').textContent = gameState.player1.name;
            document.getElementById('player2NameDisplay').textContent = gameState.player2.name;
            document.getElementById('player1ScoreDisplay').textContent = gameState.player1.points;
            document.getElementById('player2ScoreDisplay').textContent = gameState.player2.points;
            document.getElementById('player1SetsDisplay').textContent = gameState.player1.sets;
            document.getElementById('player2SetsDisplay').textContent = gameState.player2.sets;

            // Banderas
            const flag1 = getISO2Code(gameState.player1.flag);
            const flag2 = getISO2Code(gameState.player2.flag);
            document.getElementById('player1FlagDisplay').className = `fi fi-${flag1}`;
            document.getElementById('player2FlagDisplay').className = `fi fi-${flag2}`;

            // Indicador de servicio (resaltar card activo)
            const card1 = document.getElementById('playerCard1');
            const card2 = document.getElementById('playerCard2');
            if (gameState.player1.service) {
                card1.classList.add('active');
                card2.classList.remove('active');
            } else {
                card1.classList.remove('active');
                card2.classList.add('active');
            }

            // Botón de visibilidad
            updateVisibilityButton();

            // Botones de color activos
            updateBackgroundButtons();

            // Logo UI
            updateLogoUI();

            // Guardar
            localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        // Actualizar botón de visibilidad
        function updateVisibilityButton() {
            const btn = document.getElementById('visibilityToggle');
            if (gameState.overlayVisible) {
                btn.textContent = '🙈 Ocultar Overlay';
                btn.classList.remove('hidden');
            } else {
                btn.textContent = '👁️ Mostrar Overlay';
                btn.classList.add('hidden');
            }
        }

        // Toggle visibilidad del overlay
        function toggleOverlayVisibility() {
            gameState.overlayVisible = !gameState.overlayVisible;
            updateDisplay();
        }

        // Actualizar botones de color activos
        function updateBackgroundButtons() {
            document.querySelectorAll('.btn-color').forEach(btn => btn.classList.remove('active'));

            const bg = gameState.background;
            if (bg.type === 'gradient') {
                document.getElementById('bgGradient').classList.add('active');
            } else if (bg.type === 'transparent') {
                document.getElementById('bgTransparent').classList.add('active');
            } else if (bg.type === 'solid') {
                if (bg.color === '#00FF00') {
                    document.getElementById('bgGreen').classList.add('active');
                } else if (bg.color === '#0000FF') {
                    document.getElementById('bgBlue').classList.add('active');
                } else if (bg.color === '#FF00FF') {
                    document.getElementById('bgMagenta').classList.add('active');
                } else if (bg.color === '#FF0000') {
                    document.getElementById('bgRed').classList.add('active');
                }
            }
        }

        // Actualizar datos
        function updateData() {
            gameState.player1.name = document.getElementById('player1Name').value || 'Jugador 1';
            gameState.player2.name = document.getElementById('player2Name').value || 'Jugador 2';
            gameState.player1.flag = (document.getElementById('player1Flag').value || 'ESP').toUpperCase().slice(0, 3);
            gameState.player2.flag = (document.getElementById('player2Flag').value || 'ARG').toUpperCase().slice(0, 3);
            updateDisplay();
        }

        // Actualizar servicio
        function updateService() {
            const totalPoints = gameState.player1.points + gameState.player2.points;
            const p1 = gameState.player1.points;
            const p2 = gameState.player2.points;

            if (p1 >= 10 && p2 >= 10) {
                gameState.player1.service = (totalPoints % 2) === 0;
                gameState.player2.service = !gameState.player1.service;
            } else {
                const serviceBlock = Math.floor(totalPoints / 2) % 2;
                gameState.player1.service = serviceBlock === 0;
                gameState.player2.service = serviceBlock === 1;
            }
        }

        // Cambiar puntos
        function changePoints(player, delta) {
            const oldPoints = gameState['player' + player].points;
            const newPoints = Math.max(0, oldPoints + delta);
            gameState['player' + player].points = newPoints;

            if (delta > 0 && newPoints > oldPoints) {
                gameState.animations['point' + player] = Date.now();

                const otherPlayer = player === 1 ? 2 : 1;
                const otherPoints = gameState['player' + otherPlayer].points;

                if (newPoints >= 11 && newPoints - otherPoints >= 2) {
                    setTimeout(() => {
                        gameState.animations['set' + player] = Date.now();
                        gameState['player' + player].sets++;
                        gameState.player1.points = 0;
                        gameState.player2.points = 0;
                        updateDisplay();
                    }, 300);
                }
            }

            updateService();
            updateDisplay();
        }

        // Cambiar sets
        function changeSets(player, delta) {
            gameState['player' + player].sets = Math.max(0, gameState['player' + player].sets + delta);
            updateDisplay();
        }

        // Cambiar servicio
        function setService(player) {
            gameState.player1.service = player === 1;
            gameState.player2.service = player === 2;
            gameState.animations.service = Date.now();
            updateDisplay();
        }

        // Cambiar color de fondo
        function setBackground(type) {
            const colorMap = {
                'green': '#00FF00',
                'blue': '#0000FF',
                'magenta': '#FF00FF',
                'red': '#FF0000'
            };

            if (type === 'gradient') {
                gameState.background = { type: 'gradient', color: '#00FF00' };
            } else if (type === 'transparent') {
                gameState.background = { type: 'transparent', color: '#00FF00' };
            } else {
                gameState.background = { type: 'solid', color: colorMap[type] };
            }
            updateDisplay();
        }

        // Funciones del Logo
        function updateLogoUI() {
            const logo = gameState.logo || { url: '', position: 'left', enabled: false };

            document.getElementById('logoUrl').value = logo.url || '';
            document.getElementById('logoLeft').classList.toggle('active', logo.position === 'left');
            document.getElementById('logoRight').classList.toggle('active', logo.position === 'right');

            const toggleBtn = document.getElementById('logoToggle');
            toggleBtn.textContent = logo.enabled ? '✅ Activado' : '🚫 Desactivado';
            toggleBtn.classList.toggle('active', logo.enabled);

            const preview = document.getElementById('logoPreviewImg');
            if (logo.url) {
                preview.src = logo.url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function updateLogoUrl() {
            const url = document.getElementById('logoUrl').value;
            if (!gameState.logo) gameState.logo = { position: 'left', enabled: false };
            gameState.logo.url = url;
            // Activar automáticamente si hay URL
            if (url && url.trim()) {
                gameState.logo.enabled = true;
            }
            updateDisplay();
        }

        function setLogoPosition(position) {
            if (!gameState.logo) gameState.logo = { url: '', enabled: false };
            gameState.logo.position = position;
            updateDisplay();
        }

        function toggleLogo() {
            if (!gameState.logo) gameState.logo = { url: '', position: 'left' };
            gameState.logo.enabled = !gameState.logo.enabled;
            updateDisplay();
        }

        function handleLogoFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (!gameState.logo) gameState.logo = { position: 'left', enabled: false };
                    gameState.logo.url = e.target.result;
                    // Activar automáticamente cuando se sube un archivo
                    gameState.logo.enabled = true;
                    updateDisplay();
                };
                reader.readAsDataURL(file);
            }
        }

        // Reiniciar todo
        function resetAll() {
            if (confirm('¿Resetear puntos y sets a 0?')) {
                gameState.player1.points = 0;
                gameState.player2.points = 0;
                gameState.player1.sets = 0;
                gameState.player2.sets = 0;
                gameState.player1.service = true;
                gameState.player2.service = false;
                updateDisplay();
            }
        }

        // Escuchar cambios desde el overlay
        window.addEventListener('storage', (e) => {
            if (e.key === 'gameState') {
                gameState = JSON.parse(e.newValue);
                if (!gameState.animations) {
                    gameState.animations = {
                        point1: 0,
                        point2: 0,
                        set1: 0,
                        set2: 0,
                        service: 0
                    };
                }
                updateDisplay();
            }
        });

        // Cargar estado al iniciar
        loadState();
    </script>
</body>
</html>
