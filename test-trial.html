<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sistema de Trial</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            font-weight: 600;
        }
        button:hover {
            background: #5568d3;
        }
        button.secondary {
            background: #ff9800;
        }
        button.secondary:hover {
            background: #f57c00;
        }
        button.danger {
            background: #f44336;
        }
        button.danger:hover {
            background: #d32f2f;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #e8f5e9;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .warning-box {
            background: #fff3e0;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        code {
            background: #263238;
            color: #aed581;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Test - Sistema de Trial</h1>

        <div class="info-box">
            <strong>ğŸ“‹ Instrucciones:</strong><br>
            1. Haz clic en cada escenario para probarlo<br>
            2. Se abrirÃ¡ <code>control.html</code> en una nueva pestaÃ±a<br>
            3. Verifica que aparezca lo esperado<br>
            4. Cierra la pestaÃ±a y prueba otro escenario
        </div>

        <div class="warning-box">
            <strong>âš ï¸ Importante:</strong> Cada test limpia el <code>localStorage</code> y abre una nueva pestaÃ±a.
        </div>

        <!-- Estado Actual -->
        <div class="test-section">
            <h3>ğŸ“Š Estado Actual del Sistema</h3>
            <button onclick="checkCurrentState()">Ver Estado Actual</button>
            <button class="secondary" onclick="openControlPanel()">Abrir Control Panel</button>
            <div id="currentStateResult"></div>
        </div>

        <!-- Escenario 1 -->
        <div class="test-section">
            <h3>âœ… Escenario 1: Trial Activo (7 dÃ­as)</h3>
            <p><strong>Esperado:</strong> Banner naranja "â° Trial: Te quedan 7 dÃ­as de prueba"</p>
            <button onclick="testTrialActivo()">ğŸŸ  Probar Trial DÃ­a 1</button>
            <button onclick="testTrialExpirando(3)">ğŸŸ  Probar Trial DÃ­a 5 (3 dÃ­as restantes)</button>
            <button onclick="testTrialExpirando(1)">ğŸŸ  Probar Trial DÃ­a 6 (Ãºltimo dÃ­a)</button>
        </div>

        <!-- Escenario 2 -->
        <div class="test-section">
            <h3>âŒ Escenario 2: Trial Expirado</h3>
            <p><strong>Esperado:</strong> Modal bloqueante negro "â° Trial Expirado"</p>
            <button class="danger" onclick="testTrialExpirado()">âš« Probar Trial Expirado</button>
        </div>

        <!-- Escenario 3 -->
        <div class="test-section">
            <h3>âœ… Escenario 3: Licencia Activada</h3>
            <p><strong>Esperado:</strong> Barra morada "âœ¨ Licencia: [TIER] [Gestionar]"</p>
            <button onclick="testConLicencia('BASIC')">ğŸŸ£ Probar BASIC</button>
            <button onclick="testConLicencia('PRO')">ğŸŸ£ Probar PRO</button>
            <button onclick="testConLicencia('ENTERPRISE')">ğŸŸ£ Probar ENTERPRISE</button>
        </div>

        <!-- Reset -->
        <div class="test-section">
            <h3>ğŸ”„ Resetear Todo</h3>
            <p><strong>Limpia localStorage y vuelve al estado inicial</strong></p>
            <button class="danger" onclick="resetAll()">ğŸ—‘ï¸ Limpiar Todo</button>
        </div>

        <!-- Resultados -->
        <div id="results"></div>
    </div>

    <script>
        function showResult(message) {
            const results = document.getElementById('results');
            const result = document.createElement('div');
            result.className = 'result';
            result.textContent = message;
            results.innerHTML = '';
            results.appendChild(result);
        }

        function checkCurrentState() {
            const resultDiv = document.getElementById('currentStateResult');
            const firstInstall = localStorage.getItem('ppo_first_install');
            const license = localStorage.getItem('ppo_license');

            let report = '=== ESTADO ACTUAL ===\n\n';

            if (license) {
                const lic = JSON.parse(license);
                report += 'âœ… LICENCIA ACTIVA\n';
                report += `   Tier: ${lic.tier}\n`;
                report += `   CÃ³digo: ${lic.key}\n`;
                report += `   Activada: ${new Date(lic.activatedAt).toLocaleString()}\n`;
            } else {
                report += 'âŒ Sin licencia\n';
            }

            report += '\n';

            if (firstInstall) {
                const installDate = new Date(parseInt(firstInstall));
                const daysPassed = Math.floor((Date.now() - parseInt(firstInstall)) / (1000 * 60 * 60 * 24));
                const daysLeft = 7 - daysPassed;

                report += 'ğŸ“… TRIAL:\n';
                report += `   Instalado: ${installDate.toLocaleString()}\n`;
                report += `   DÃ­as pasados: ${daysPassed}\n`;
                report += `   DÃ­as restantes: ${Math.max(0, daysLeft)}\n`;
                report += `   Estado: ${daysLeft > 0 ? 'âœ… Activo' : 'âŒ Expirado'}\n`;
            } else {
                report += 'ğŸ“… TRIAL: No iniciado\n';
            }

            resultDiv.innerHTML = `<div class="result">${report}</div>`;
        }

        function openControlPanel() {
            window.open('control.html', '_blank');
            showResult('âœ… Control Panel abierto en nueva pestaÃ±a');
        }

        function testTrialActivo() {
            localStorage.clear();
            localStorage.setItem('ppo_first_install', Date.now().toString());
            window.open('control.html', '_blank');
            showResult('âœ… Test preparado: Trial activo (7 dÃ­as)\n\nVerifica en la nueva pestaÃ±a:\n- Banner naranja arriba\n- Texto: "â° Trial: Te quedan 7 dÃ­as de prueba"\n- BotÃ³n "Activar Ahora"');
        }

        function testTrialExpirando(diasRestantes) {
            localStorage.clear();
            const daysAgo = (7 - diasRestantes) * 24 * 60 * 60 * 1000;
            localStorage.setItem('ppo_first_install', (Date.now() - daysAgo).toString());
            window.open('control.html', '_blank');

            const mensaje = diasRestantes === 1 ? 'Ãºltimo dÃ­a' : diasRestantes + ' dÃ­as';
            showResult(`âœ… Test preparado: Trial con ${diasRestantes} dÃ­as restantes\n\nVerifica en la nueva pestaÃ±a:\n- Banner naranja arriba\n- Texto: "â° Trial: Te quedan ${mensaje} de prueba"\n- BotÃ³n "Activar Ahora"`);
        }

        function testTrialExpirado() {
            localStorage.clear();
            const eightDaysAgo = Date.now() - (8 * 24 * 60 * 60 * 1000);
            localStorage.setItem('ppo_first_install', eightDaysAgo.toString());
            window.open('control.html', '_blank');
            showResult('âœ… Test preparado: Trial expirado\n\nVerifica en la nueva pestaÃ±a:\n- Modal negro bloqueante\n- TÃ­tulo: "â° Trial Expirado"\n- No se puede cerrar\n- Pide cÃ³digo de licencia');
        }

        function testConLicencia(tier) {
            localStorage.clear();

            const codes = {
                'BASIC': 'PPO-BASIC-20251026-6B437D7B',
                'PRO': 'PPO-PRO-20251026-4F3D160A',
                'ENTERPRISE': 'PPO-ENTERPRISE-20251026-38A00E05'
            };

            const features = {
                'BASIC': ['themes_premium_3', 'stats_basic'],
                'PRO': ['themes_unlimited', 'stats_advanced', 'cloud_save', 'mobile_control'],
                'ENTERPRISE': ['all']
            };

            localStorage.setItem('ppo_license', JSON.stringify({
                key: codes[tier],
                tier: tier,
                features: features[tier],
                activatedAt: Date.now(),
                online: null
            }));

            window.open('control.html', '_blank');
            showResult(`âœ… Test preparado: Licencia ${tier} activada\n\nVerifica en la nueva pestaÃ±a:\n- Barra morada arriba\n- Texto: "âœ¨ Licencia: ${tier}"\n- BotÃ³n "Gestionar"\n- NO hay banner naranja\n- Clic en "Gestionar" muestra info (no pide activar)`);
        }

        function resetAll() {
            localStorage.clear();
            document.getElementById('currentStateResult').innerHTML = '';
            showResult('âœ… Todo limpiado\n\nlocalStorage completamente vacÃ­o.\nLa prÃ³xima vez que abras control.html iniciarÃ¡ como primera instalaciÃ³n.');
        }

        // Mostrar estado al cargar
        window.addEventListener('load', () => {
            checkCurrentState();
        });
    </script>
</body>
</html>
